<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NC Wash Works - Pricing Calculator</title>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-primary: #08080d;
      --bg-card: #111118;
      --bg-card-alt: #15151d;
      --bg-input: #1a1a24;
      --bg-hover: #1f1f2b;
      --border: #252535;
      --border-light: #2e2e40;
      --border-focus: #4A90D9;
      --text-primary: #ededf2;
      --text-secondary: #8e8ea6;
      --text-muted: #5c5c74;
      --accent: #4A90D9;
      --accent-soft: #6BB5E0;
      --accent-glow: rgba(74, 144, 217, 0.12);
      --accent-glow-md: rgba(74, 144, 217, 0.20);
      --green: #34d399;
      --green-soft: rgba(52, 211, 153, 0.10);
      --green-border: rgba(52, 211, 153, 0.18);
      --amber: #fbbf24;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.15);
      --shadow-md: 0 4px 20px rgba(0,0,0,0.25);
      --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    html { font-size: 16px; scroll-behavior: smooth; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(ellipse at 25% 0%, rgba(74, 144, 217, 0.05) 0%, transparent 60%),
                  radial-gradient(ellipse at 75% 100%, rgba(53, 120, 181, 0.03) 0%, transparent 60%);
      pointer-events: none;
    }

    /* ===== Layout ===== */
    .container {
      position: relative;
      z-index: 1;
      max-width: 1080px;
      margin: 0 auto;
      padding: 2.5rem 1.5rem 4rem;
    }

    .calculator {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 2rem;
      align-items: start;
    }

    @media (max-width: 820px) {
      .calculator { grid-template-columns: 1fr; }
      .container { padding: 1.5rem 1rem 3rem; }
    }

    /* ===== Header ===== */
    .header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .header__brand {
      display: inline-flex;
      align-items: center;
      gap: 0.6rem;
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--accent-soft);
      margin-bottom: 1.25rem;
    }

    .header__brand-logo {
      height: 36px;
      width: auto;
      object-fit: contain;
      border-radius: 6px;
    }

    .header__title {
      font-size: clamp(1.6rem, 4.5vw, 2.25rem);
      font-weight: 700;
      letter-spacing: -0.025em;
      line-height: 1.15;
      margin-bottom: 0.6rem;
    }

    .header__title em {
      font-style: normal;
      background: linear-gradient(135deg, var(--accent) 0%, #6BB5E0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header__sub {
      color: var(--text-secondary);
      font-size: 0.95rem;
      max-width: 440px;
      margin: 0 auto;
    }

    /* ===== Card ===== */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.75rem;
    }

    .card + .card { margin-top: 1.25rem; }

    .card__heading {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-primary);
    }

    .card__heading-icon {
      width: 28px; height: 28px;
      background: var(--accent-glow);
      border-radius: var(--radius-sm);
      display: grid; place-items: center;
      flex-shrink: 0;
    }

    .card__heading-icon svg {
      width: 14px; height: 14px;
      stroke: var(--accent);
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    /* ===== Service Grid ===== */
    .services {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
    }

    @media (max-width: 480px) {
      .services { grid-template-columns: 1fr; }
    }

    .service {
      position: relative;
      display: flex;
      align-items: center;
      gap: 0.65rem;
      padding: 0.7rem 0.85rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition);
      user-select: none;
    }

    .service:hover { background: var(--bg-hover); border-color: var(--border-light); }

    .service.active {
      background: var(--accent-glow);
      border-color: var(--accent);
    }

    .service__check {
      width: 18px; height: 18px;
      border: 2px solid var(--border-light);
      border-radius: 5px;
      display: grid; place-items: center;
      flex-shrink: 0;
      transition: all var(--transition);
    }

    .service.active .service__check {
      background: var(--accent);
      border-color: var(--accent);
    }

    .service__check svg {
      width: 10px; height: 10px;
      stroke: white; fill: none;
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
      opacity: 0;
      transform: scale(0.5);
      transition: all var(--transition);
    }

    .service.active .service__check svg {
      opacity: 1;
      transform: scale(1);
    }

    .service__body { flex: 1; min-width: 0; }

    .service__name {
      font-size: 0.82rem;
      font-weight: 500;
      line-height: 1.3;
    }

    .service__range {
      font-size: 0.72rem;
      color: var(--text-muted);
      line-height: 1.3;
    }

    /* ===== Stacked Service Configs ===== */
    .configs { margin-top: 1.25rem; }

    .config-item {
      background: var(--bg-card-alt);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 1rem 1.15rem;
      animation: slideIn 0.25s ease forwards;
    }

    .config-item + .config-item { margin-top: 0.625rem; }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-6px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .config-item__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }

    .config-item__title {
      font-size: 0.85rem;
      font-weight: 600;
    }

    .config-item__remove {
      width: 22px; height: 22px;
      background: none;
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-muted);
      cursor: pointer;
      display: grid; place-items: center;
      transition: all var(--transition);
      font-size: 0.75rem;
      line-height: 1;
    }

    .config-item__remove:hover {
      border-color: #ef4444;
      color: #ef4444;
      background: rgba(239, 68, 68, 0.08);
    }

    /* Size Selector */
    .size-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.4rem;
    }

    .size-btn {
      position: relative;
      padding: 0.55rem 0.4rem;
      background: var(--bg-input);
      border: 1.5px solid var(--border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      text-align: center;
      transition: all var(--transition);
      font-family: inherit;
      color: var(--text-primary);
    }

    .size-btn:hover { border-color: var(--border-light); background: var(--bg-hover); }

    .size-btn.active {
      border-color: var(--accent);
      background: var(--accent-glow);
    }

    .size-btn__label {
      display: block;
      font-size: 0.68rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 0.15rem;
    }

    .size-btn.active .size-btn__label { color: var(--accent-soft); }

    .size-btn__price {
      display: block;
      font-size: 0.88rem;
      font-weight: 700;
      line-height: 1.2;
    }

    .size-btn__sqft {
      display: block;
      font-size: 0.65rem;
      color: var(--text-muted);
      margin-top: 0.1rem;
    }

    .size-btn__popular {
      position: absolute;
      top: -7px;
      left: 50%;
      transform: translateX(-50%);
      padding: 0.05rem 0.5rem;
      background: var(--accent);
      color: white;
      font-size: 0.58rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      border-radius: 999px;
      white-space: nowrap;
    }

    .size-btn--popular { border-color: rgba(74, 144, 217, 0.35); }

    /* ===== Context hint under configs ===== */
    .context-hint {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 0.875rem;
      padding: 0.55rem 0.75rem;
      background: var(--accent-glow);
      border-radius: var(--radius-sm);
      font-size: 0.73rem;
      color: var(--text-secondary);
      line-height: 1.35;
    }

    .context-hint svg {
      width: 13px; height: 13px;
      stroke: var(--accent-soft);
      fill: none;
      stroke-width: 2;
      flex-shrink: 0;
    }

    /* ===== Add-ons ===== */
    .addons { display: flex; flex-direction: column; gap: 0.5rem; }

    .addon {
      display: flex;
      align-items: center;
      gap: 0.65rem;
      padding: 0.65rem 0.85rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition);
      user-select: none;
    }

    .addon:hover { background: var(--bg-hover); border-color: var(--border-light); }
    .addon.active { background: var(--accent-glow); border-color: var(--accent); }

    .addon__check {
      width: 18px; height: 18px;
      border: 2px solid var(--border-light);
      border-radius: 5px;
      display: grid; place-items: center;
      flex-shrink: 0;
      transition: all var(--transition);
    }

    .addon.active .addon__check { background: var(--accent); border-color: var(--accent); }

    .addon__check svg {
      width: 10px; height: 10px;
      stroke: white; fill: none;
      stroke-width: 3;
      stroke-linecap: round; stroke-linejoin: round;
      opacity: 0; transform: scale(0.5);
      transition: all var(--transition);
    }

    .addon.active .addon__check svg { opacity: 1; transform: scale(1); }

    .addon__body { flex: 1; min-width: 0; }
    .addon__name { font-size: 0.82rem; font-weight: 500; line-height: 1.3; }
    .addon__desc { font-size: 0.7rem; color: var(--text-muted); line-height: 1.3; }

    .addon__price {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--accent-soft);
      white-space: nowrap;
    }

    /* ===== Quote Panel ===== */
    .quote-panel { position: sticky; top: 2rem; }

    @media (max-width: 820px) { .quote-panel { position: static; } }

    .quote-panel .card {
      background: linear-gradient(180deg, var(--bg-card) 0%, #0e0e16 100%);
      border-color: #2a2a3e;
    }

    .quote-empty {
      text-align: center;
      padding: 2rem 1rem;
      color: var(--text-muted);
      font-size: 0.82rem;
      line-height: 1.5;
    }

    /* Breakdown */
    .breakdown { margin-bottom: 1rem; }

    .bk-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      font-size: 0.82rem;
    }

    .bk-row + .bk-row { border-top: 1px solid var(--border); }

    .bk-label { color: var(--text-secondary); }
    .bk-value { font-weight: 500; white-space: nowrap; }

    .bk-row--service .bk-label {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .bk-dot {
      width: 5px; height: 5px;
      border-radius: 50%;
      background: var(--accent);
      flex-shrink: 0;
    }

    .bk-row--addon .bk-label::before {
      content: '+';
      color: var(--accent-soft);
      font-weight: 600;
      font-size: 0.75rem;
      margin-right: 0.25rem;
    }

    /* Multi-service badge */
    .bundle-note {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.5rem 0.75rem;
      background: var(--green-soft);
      border: 1px solid var(--green-border);
      border-radius: var(--radius-sm);
      margin-bottom: 1rem;
      font-size: 0.75rem;
      color: var(--green);
      font-weight: 500;
      opacity: 0;
      max-height: 0;
      padding-top: 0;
      padding-bottom: 0;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .bundle-note.visible {
      opacity: 1;
      max-height: 50px;
      padding: 0.5rem 0.75rem;
    }

    .bundle-note svg {
      width: 13px; height: 13px;
      stroke: var(--green);
      fill: none; stroke-width: 2;
      flex-shrink: 0;
    }

    /* Divider */
    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border), transparent);
      margin: 0.75rem 0;
    }

    /* Total */
    .total-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-bottom: 0.2rem;
    }

    .total-label {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .total-amount {
      font-size: 1.75rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1;
      background: linear-gradient(135deg, #d0d0e0 0%, #9090a0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      transition: all 0.3s ease;
    }

    .total-amount.live {
      background: linear-gradient(135deg, var(--accent) 0%, #6BB5E0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .total-context {
      text-align: right;
      font-size: 0.7rem;
      color: var(--text-muted);
      margin-bottom: 1.25rem;
      min-height: 1em;
    }

    /* CTA */
    .cta {
      width: 100%;
      padding: 0.9rem 1rem;
      background: var(--accent);
      color: white;
      font-size: 0.92rem;
      font-weight: 600;
      font-family: inherit;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition);
    }

    .cta:hover {
      background: var(--accent-soft);
      transform: translateY(-1px);
      box-shadow: 0 4px 20px rgba(74, 144, 217, 0.3);
    }

    .cta:active { transform: translateY(0); }

    .cta:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    .cta:disabled:hover { background: var(--accent); }

    .cta__sub {
      display: block;
      font-size: 0.65rem;
      font-weight: 400;
      opacity: 0.75;
      margin-top: 0.15rem;
    }

    /* Trust */
    .trust-row {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
      padding-top: 0.85rem;
      border-top: 1px solid var(--border);
      flex-wrap: wrap;
    }

    .trust-item {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    .trust-item svg {
      width: 11px; height: 11px;
      stroke: var(--text-muted); fill: none;
      stroke-width: 2;
      stroke-linecap: round; stroke-linejoin: round;
    }

    /* ===== Footer ===== */
    .footer {
      text-align: center;
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    /* ===== Animations ===== */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .fade-up {
      animation: fadeUp 0.4s ease forwards;
    }

    .fade-up:nth-child(2) { animation-delay: 0.06s; }
    .fade-up:nth-child(3) { animation-delay: 0.12s; }

    /* ===== Scrollbar ===== */
    ::-webkit-scrollbar { width: 7px; }
    ::-webkit-scrollbar-track { background: var(--bg-primary); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #3a3a50; }

    /* ===== Modal ===== */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 100;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(4px);
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.open { display: flex; }

    .modal-box {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 2rem;
      max-width: 420px;
      width: 90%;
      text-align: center;
      box-shadow: var(--shadow-md);
    }

    .modal-icon {
      width: 44px; height: 44px;
      background: var(--green-soft);
      border-radius: 50%;
      display: grid; place-items: center;
      margin: 0 auto 1rem;
    }

    .modal-icon svg {
      width: 22px; height: 22px;
      stroke: var(--green); fill: none;
      stroke-width: 2;
    }

    .modal-title { font-size: 1.05rem; font-weight: 600; margin-bottom: 0.4rem; }
    .modal-desc { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.5rem; }
    .modal-sub { font-size: 0.75rem; color: var(--text-muted); margin-bottom: 1.25rem; }

    .modal-close {
      padding: 0.55rem 1.75rem;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-size: 0.88rem;
      font-weight: 600;
      cursor: pointer;
      font-family: inherit;
      transition: background var(--transition);
    }

    .modal-close:hover { background: var(--accent-soft); }
  </style>
</head>
<body>

<div class="container">

  <header class="header fade-up">
    <div class="header__brand">
      <img src="./logo.png" alt="NC Wash Works" class="header__brand-logo">
      NC Wash Works
    </div>
    <h1 class="header__title">Build Your <em>Custom Quote</em></h1>
    <p class="header__sub">Select one or more services below. We'll calculate everything instantly.</p>
  </header>

  <div class="calculator">
    <!-- Left Column -->
    <div class="left-col">

      <!-- Services -->
      <div class="card fade-up">
        <div class="card__heading">
          <div class="card__heading-icon">
            <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          </div>
          Services
        </div>

        <div class="services" id="serviceGrid"></div>

        <!-- Stacked configs appear here -->
        <div class="configs" id="configs"></div>

        <div class="context-hint" id="contextHint" style="display:none;">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          <span id="contextHintText"></span>
        </div>
      </div>

      <!-- Add-ons -->
      <div class="card fade-up">
        <div class="card__heading">
          <div class="card__heading-icon">
            <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          </div>
          Extras
        </div>
        <div class="addons" id="addons"></div>
      </div>

    </div>

    <!-- Right Column: Quote Panel -->
    <div class="quote-panel fade-up">
      <div class="card">
        <div class="card__heading">
          <div class="card__heading-icon">
            <svg viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
          </div>
          Your Estimate
        </div>

        <div class="bundle-note" id="bundleNote">
          <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
          <span id="bundleNoteText"></span>
        </div>

        <div class="breakdown" id="breakdown">
          <div class="quote-empty">Select a service to get started.</div>
        </div>

        <div class="divider"></div>

        <div class="total-row">
          <span class="total-label">Estimated Range</span>
          <span class="total-amount" id="totalAmount">&mdash;</span>
        </div>
        <div class="total-context" id="totalContext"></div>

        <button class="cta" id="cta" disabled onclick="handleCta()">
          Request Your Quote
          <span class="cta__sub">Free &middot; No commitment</span>
        </button>

        <div class="trust-row">
          <span class="trust-item">
            <svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
            No payment needed
          </span>
          <span class="trust-item">
            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
            Price-match guarantee
          </span>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">NC Wash Works &mdash; Professional Property Cleaning</footer>
</div>

<!-- Modal -->
<div class="modal-overlay" id="modal">
  <div class="modal-box">
    <div class="modal-icon"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></div>
    <div class="modal-title">Quote Request Received</div>
    <div class="modal-desc" id="modalDesc"></div>
    <div class="modal-sub">A specialist will confirm your final price within 24 hours.</div>
    <button class="modal-close" onclick="closeModal()">Done</button>
  </div>
</div>

<script>
// =====================================================================
// DATA
// =====================================================================
const SERVICES = {
  driveway:   { name: 'Driveway / Concrete',  icon: 'driveway',  tiers: { small: { sqft: 'Up to 500 ft\u00B2',          low: 120, high: 200 }, standard: { sqft: '500\u20131,500 ft\u00B2',    low: 200, high: 350 }, large: { sqft: '1,500+ ft\u00B2',   low: 350, high: 600 } } },
  house:      { name: 'House Wash',            icon: 'house',     tiers: { small: { sqft: 'Up to 1,000 ft\u00B2',        low: 200, high: 350 }, standard: { sqft: '1,000\u20132,500 ft\u00B2',  low: 350, high: 625 }, large: { sqft: '2,500+ ft\u00B2',   low: 625, high: 1000 } } },
  roof:       { name: 'Roof Cleaning',         icon: 'roof',      tiers: { small: { sqft: 'Up to 1,000 ft\u00B2',        low: 300, high: 450 }, standard: { sqft: '1,000\u20132,000 ft\u00B2',  low: 450, high: 700 }, large: { sqft: '2,000+ ft\u00B2',   low: 700, high: 1200 } } },
  patio:      { name: 'Patio / Deck',          icon: 'patio',     tiers: { small: { sqft: 'Up to 300 ft\u00B2',          low: 100, high: 175 }, standard: { sqft: '300\u2013800 ft\u00B2',      low: 175, high: 300 }, large: { sqft: '800+ ft\u00B2',     low: 300, high: 500 } } },
  fence:      { name: 'Fence',                 icon: 'fence',     tiers: { small: { sqft: 'Up to 200 ft\u00B2',          low: 100, high: 150 }, standard: { sqft: '200\u2013600 ft\u00B2',      low: 150, high: 250 }, large: { sqft: '600+ ft\u00B2',     low: 250, high: 400 } } },
  garage:     { name: 'Garage Floor',          icon: 'garage',    tiers: { small: { sqft: 'Up to 300 ft\u00B2',          low: 80,  high: 130 }, standard: { sqft: '300\u2013600 ft\u00B2',      low: 130, high: 200 }, large: { sqft: '600+ ft\u00B2',     low: 200, high: 350 } } },
  commercial: { name: 'Commercial Exterior',   icon: 'commercial',tiers: { small: { sqft: 'Up to 2,000 ft\u00B2',        low: 500, high: 800 }, standard: { sqft: '2,000\u20135,000 ft\u00B2',  low: 800, high: 1500 }, large: { sqft: '5,000+ ft\u00B2', low: 1500, high: 2500 } } },
  pool:       { name: 'Pool Deck',             icon: 'pool',      tiers: { small: { sqft: 'Up to 400 ft\u00B2',          low: 150, high: 225 }, standard: { sqft: '400\u20131,000 ft\u00B2',    low: 225, high: 400 }, large: { sqft: '1,000+ ft\u00B2',   low: 400, high: 650 } } },
};

const ADDONS = [
  { id: 'sealant', name: 'Surface Sealant',    desc: 'Protective coating after wash',   price: 150 },
  { id: 'stain',   name: 'Stain Treatment',     desc: 'Oil, rust & tough stain removal',  price: 125 },
  { id: 'gutter',  name: 'Gutter Brightening',  desc: 'Clean exterior gutter faces',      price: 125 },
  { id: 'window',  name: 'Window Rinse',        desc: 'Exterior window spot-free rinse',  price: 75 },
  { id: 'bio',     name: 'Bio-Wash Treatment',  desc: 'Mold & algae prevention coat',     price: 100 },
  { id: 'rush',    name: 'Priority Scheduling', desc: 'Guaranteed within 48 hours',       price: 100 },
];

// Multi-service discount tiers
const BUNDLE_DISCOUNTS = [
  { min: 4, pct: 15, label: 'Whole-property package' },
  { min: 3, pct: 12, label: 'Multi-service bundle' },
  { min: 2, pct: 8,  label: 'Two-service bundle' },
];

// =====================================================================
// STATE
// =====================================================================
let state = {
  // Map<serviceKey, tierKey>  — e.g. { driveway: 'standard', roof: 'large' }
  selectedServices: {},
  activeAddons: new Set(),
};

// =====================================================================
// DOM
// =====================================================================
const serviceGrid  = document.getElementById('serviceGrid');
const configsEl    = document.getElementById('configs');
const addonsEl     = document.getElementById('addons');
const breakdownEl  = document.getElementById('breakdown');
const totalAmountEl= document.getElementById('totalAmount');
const totalContextEl=document.getElementById('totalContext');
const bundleNote   = document.getElementById('bundleNote');
const bundleNoteText=document.getElementById('bundleNoteText');
const contextHint  = document.getElementById('contextHint');
const contextHintText=document.getElementById('contextHintText');
const ctaEl        = document.getElementById('cta');

function fmt(n) { return '$' + Math.round(n).toLocaleString(); }

// =====================================================================
// RENDER: Service Grid
// =====================================================================
function renderServiceGrid() {
  const keys = Object.keys(SERVICES);
  serviceGrid.innerHTML = keys.map(key => {
    const s = SERVICES[key];
    const isActive = key in state.selectedServices;
    const stdTier = s.tiers.standard;
    return `
      <div class="service${isActive ? ' active' : ''}" onclick="toggleService('${key}')">
        <div class="service__check">
          <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
        </div>
        <div class="service__body">
          <div class="service__name">${s.name}</div>
          <div class="service__range">${fmt(stdTier.low)} \u2013 ${fmt(stdTier.high)}</div>
        </div>
      </div>`;
  }).join('');
}

// =====================================================================
// RENDER: Stacked Config Cards
// =====================================================================
function renderConfigs() {
  const keys = Object.keys(state.selectedServices);
  if (keys.length === 0) {
    configsEl.innerHTML = '';
    contextHint.style.display = 'none';
    return;
  }

  configsEl.innerHTML = keys.map(key => {
    const s = SERVICES[key];
    const selectedTier = state.selectedServices[key];
    const tierKeys = ['small', 'standard', 'large'];

    const sizeBtns = tierKeys.map(tk => {
      const t = s.tiers[tk];
      const isActive = selectedTier === tk;
      const isPopular = tk === 'standard';
      const classes = ['size-btn'];
      if (isActive) classes.push('active');
      if (isPopular) classes.push('size-btn--popular');

      return `
        <button class="${classes.join(' ')}" onclick="setTier('${key}','${tk}')">
          ${isPopular ? '<span class="size-btn__popular">Most Chosen</span>' : ''}
          <span class="size-btn__label">${tk === 'small' ? 'Small' : tk === 'standard' ? 'Standard' : 'Large'}</span>
          <span class="size-btn__price">${fmt(t.low)}\u2013${fmt(t.high)}</span>
          <span class="size-btn__sqft">${t.sqft}</span>
        </button>`;
    }).join('');

    return `
      <div class="config-item">
        <div class="config-item__header">
          <span class="config-item__title">${s.name}</span>
          <button class="config-item__remove" onclick="toggleService('${key}')" title="Remove">&times;</button>
        </div>
        <div class="size-row">${sizeBtns}</div>
      </div>`;
  }).join('');

  // Context hint
  const configuredCount = keys.filter(k => state.selectedServices[k]).length;
  const unconfiguredCount = keys.length - configuredCount;

  if (unconfiguredCount > 0) {
    contextHintText.textContent = 'Choose a project size for each service to see your estimate.';
    contextHint.style.display = '';
  } else if (keys.length >= 2) {
    const disc = getDiscount();
    contextHintText.textContent = keys.length >= 4
      ? 'Whole-property discount applied automatically.'
      : keys.length >= 3
        ? 'Multi-service discount applied automatically.'
        : 'Multi-service discount included in your estimate.';
    contextHint.style.display = '';
  } else {
    contextHint.style.display = 'none';
  }
}

// =====================================================================
// RENDER: Add-ons
// =====================================================================
function renderAddons() {
  addonsEl.innerHTML = ADDONS.map(a => `
    <div class="addon${state.activeAddons.has(a.id) ? ' active' : ''}" onclick="toggleAddon('${a.id}')">
      <div class="addon__check">
        <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
      </div>
      <div class="addon__body">
        <div class="addon__name">${a.name}</div>
        <div class="addon__desc">${a.desc}</div>
      </div>
      <div class="addon__price">${fmt(a.price)}</div>
    </div>`).join('');
}

// =====================================================================
// ACTIONS
// =====================================================================
function toggleService(key) {
  if (key in state.selectedServices) {
    delete state.selectedServices[key];
  } else {
    // Default to no tier selected yet — user must pick
    state.selectedServices[key] = '';
  }
  renderServiceGrid();
  renderConfigs();
  calculate();
}

function setTier(serviceKey, tierKey) {
  state.selectedServices[serviceKey] = tierKey;
  renderConfigs();
  calculate();
}

function toggleAddon(id) {
  if (state.activeAddons.has(id)) state.activeAddons.delete(id);
  else state.activeAddons.add(id);
  renderAddons();
  calculate();
}

// =====================================================================
// DISCOUNT LOGIC
// =====================================================================
function getDiscount() {
  const count = Object.keys(state.selectedServices).length;
  for (const d of BUNDLE_DISCOUNTS) {
    if (count >= d.min) return d;
  }
  return null;
}

// =====================================================================
// CALCULATE
// =====================================================================
function calculate() {
  const entries = Object.entries(state.selectedServices);
  const configured = entries.filter(([, tier]) => tier !== '');

  if (configured.length === 0) {
    breakdownEl.innerHTML = '<div class="quote-empty">Select a service to get started.</div>';
    totalAmountEl.innerHTML = '&mdash;';
    totalAmountEl.classList.remove('live');
    totalContextEl.textContent = '';
    bundleNote.classList.remove('visible');
    ctaEl.disabled = true;
    return;
  }

  // Has at least one unconfigured service?
  const allConfigured = entries.every(([, tier]) => tier !== '');

  // Sum service ranges
  let servLow = 0, servHigh = 0;
  const serviceRows = [];

  for (const [key, tierKey] of configured) {
    const s = SERVICES[key];
    const t = s.tiers[tierKey];
    servLow += t.low;
    servHigh += t.high;
    const sizeLabel = tierKey === 'small' ? 'Small' : tierKey === 'standard' ? 'Standard' : 'Large';
    serviceRows.push({ label: s.name + ' \u00B7 ' + sizeLabel, low: t.low, high: t.high });
  }

  // Discount on services
  const disc = getDiscount();
  let discountLow = 0, discountHigh = 0;
  if (disc) {
    discountLow = Math.round(servLow * disc.pct / 100);
    discountHigh = Math.round(servHigh * disc.pct / 100);
  }

  // Addons
  let addonsTotal = 0;
  const addonRows = [];
  ADDONS.forEach(a => {
    if (state.activeAddons.has(a.id)) {
      addonsTotal += a.price;
      addonRows.push({ label: a.name, price: a.price });
    }
  });

  const totalLow  = servLow - discountLow + addonsTotal;
  const totalHigh = servHigh - discountHigh + addonsTotal;

  // Build breakdown
  let html = '';
  serviceRows.forEach(r => {
    html += `<div class="bk-row bk-row--service">
      <span class="bk-label"><span class="bk-dot"></span>${r.label}</span>
      <span class="bk-value">${fmt(r.low)} \u2013 ${fmt(r.high)}</span>
    </div>`;
  });

  if (disc) {
    html += `<div class="bk-row">
      <span class="bk-label" style="color:var(--green)">${disc.label} (${disc.pct}% off)</span>
      <span class="bk-value" style="color:var(--green)">\u2212${fmt(discountLow)} \u2013 ${fmt(discountHigh)}</span>
    </div>`;
  }

  addonRows.forEach(r => {
    html += `<div class="bk-row bk-row--addon">
      <span class="bk-label">${r.label}</span>
      <span class="bk-value">${fmt(r.price)}</span>
    </div>`;
  });

  breakdownEl.innerHTML = html;

  // Total
  totalAmountEl.textContent = fmt(totalLow) + ' \u2013 ' + fmt(totalHigh);
  totalAmountEl.classList.add('live');

  // Context note — soft framing
  if (disc) {
    totalContextEl.textContent = 'Most clients in this range spend around ' + fmt(Math.round((totalLow + totalHigh) / 2));
  } else if (configured.length === 1) {
    const mid = Math.round((totalLow + totalHigh) / 2);
    totalContextEl.textContent = 'Most clients spend around ' + fmt(mid);
  } else {
    totalContextEl.textContent = '';
  }

  // Bundle note
  if (disc) {
    bundleNoteText.textContent = disc.label + ' \u2014 ' + disc.pct + '% off services included';
    bundleNote.classList.add('visible');
  } else {
    bundleNote.classList.remove('visible');
  }

  // CTA
  ctaEl.disabled = !allConfigured;
}

// =====================================================================
// CTA / MODAL
// =====================================================================
function handleCta() {
  const entries = Object.entries(state.selectedServices);
  if (entries.length === 0) return;

  const names = entries.map(([key]) => SERVICES[key].name).join(', ');
  document.getElementById('modalDesc').textContent = names + ' \u2014 ' + totalAmountEl.textContent;
  document.getElementById('modal').classList.add('open');
}

function closeModal() {
  document.getElementById('modal').classList.remove('open');
}

document.getElementById('modal').addEventListener('click', e => {
  if (e.target === e.currentTarget) closeModal();
});

document.addEventListener('keydown', e => {
  if (e.key === 'Escape') closeModal();
});

// =====================================================================
// INIT
// =====================================================================
renderServiceGrid();
renderAddons();
calculate();
</script>

</body>
</html>
