<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>InspectorPro - Pricing Calculator</title>
  <style>
    /* ===== Reset & Base ===== */
    *, *::before, *::after {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: #16161f;
      --bg-input: #1c1c28;
      --bg-hover: #22222f;
      --border: #2a2a3a;
      --border-focus: #6366f1;
      --text-primary: #f0f0f5;
      --text-secondary: #9090a8;
      --text-muted: #60607a;
      --accent: #6366f1;
      --accent-hover: #818cf8;
      --accent-glow: rgba(99, 102, 241, 0.15);
      --accent-glow-strong: rgba(99, 102, 241, 0.3);
      --success: #22c55e;
      --success-bg: rgba(34, 197, 94, 0.1);
      --warning: #f59e0b;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.3);
      --shadow-lg: 0 8px 40px rgba(0, 0, 0, 0.4);
      --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    html {
      font-size: 16px;
      scroll-behavior: smooth;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* ===== Background Effect ===== */
    body::before {
      content: '';
      position: fixed;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(ellipse at 30% 20%, rgba(99, 102, 241, 0.06) 0%, transparent 50%),
                  radial-gradient(ellipse at 70% 80%, rgba(139, 92, 246, 0.04) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    /* ===== Layout ===== */
    .container {
      position: relative;
      z-index: 1;
      max-width: 960px;
      margin: 0 auto;
      padding: 2rem 1.25rem 4rem;
    }

    /* ===== Header ===== */
    .header {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .header__logo {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.8rem;
      font-weight: 600;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      color: var(--accent);
      margin-bottom: 1rem;
    }

    .header__logo-icon {
      width: 28px;
      height: 28px;
      background: var(--accent);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .header__logo-icon svg {
      width: 16px;
      height: 16px;
      fill: white;
    }

    .header__title {
      font-size: clamp(1.75rem, 5vw, 2.5rem);
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1.2;
      margin-bottom: 0.5rem;
    }

    .header__title span {
      background: linear-gradient(135deg, var(--accent) 0%, #a78bfa 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header__subtitle {
      color: var(--text-secondary);
      font-size: 1.05rem;
      max-width: 500px;
      margin: 0 auto;
    }

    /* ===== Calculator Grid ===== */
    .calculator {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
      align-items: start;
    }

    @media (max-width: 720px) {
      .calculator {
        grid-template-columns: 1fr;
      }
    }

    /* ===== Card ===== */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.75rem;
      transition: border-color var(--transition);
    }

    .card:hover {
      border-color: #35354a;
    }

    .card__title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card__title-icon {
      width: 32px;
      height: 32px;
      background: var(--accent-glow);
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .card__title-icon svg {
      width: 16px;
      height: 16px;
      stroke: var(--accent);
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    /* ===== Form Elements ===== */
    .form-group {
      margin-bottom: 1.25rem;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
    }

    input[type="number"],
    select {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 1rem;
      font-family: inherit;
      transition: border-color var(--transition), box-shadow var(--transition);
      appearance: none;
      -webkit-appearance: none;
    }

    input[type="number"]:focus,
    select:focus {
      outline: none;
      border-color: var(--border-focus);
      box-shadow: 0 0 0 3px var(--accent-glow);
    }

    input[type="number"]::placeholder {
      color: var(--text-muted);
    }

    /* Custom select arrow */
    .select-wrapper {
      position: relative;
    }

    .select-wrapper::after {
      content: '';
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      width: 0;
      height: 0;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-top: 5px solid var(--text-muted);
      pointer-events: none;
    }

    select {
      cursor: pointer;
      padding-right: 2.5rem;
    }

    select option {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    /* ===== Square Footage Input ===== */
    .sqft-input-group {
      position: relative;
    }

    .sqft-input-group input {
      padding-right: 3rem;
    }

    .sqft-input-group__suffix {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.85rem;
      color: var(--text-muted);
      pointer-events: none;
    }

    /* ===== Range Slider ===== */
    .range-display {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.25rem;
    }

    .range-display__value {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--accent);
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      background: var(--bg-input);
      border-radius: 3px;
      outline: none;
      -webkit-appearance: none;
      appearance: none;
      cursor: pointer;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      background: var(--accent);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
      transition: transform var(--transition), box-shadow var(--transition);
    }

    input[type="range"]::-webkit-slider-thumb:hover {
      transform: scale(1.15);
      box-shadow: 0 2px 12px rgba(99, 102, 241, 0.6);
    }

    input[type="range"]::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: var(--accent);
      border: none;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.4);
    }

    /* ===== Add-ons ===== */
    .addons-list {
      display: flex;
      flex-direction: column;
      gap: 0.625rem;
    }

    .addon {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition);
      user-select: none;
    }

    .addon:hover {
      background: var(--bg-hover);
      border-color: #35354a;
    }

    .addon.active {
      background: var(--accent-glow);
      border-color: var(--accent);
    }

    .addon__checkbox {
      width: 20px;
      height: 20px;
      border: 2px solid var(--border);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      transition: all var(--transition);
    }

    .addon.active .addon__checkbox {
      background: var(--accent);
      border-color: var(--accent);
    }

    .addon__checkbox svg {
      width: 12px;
      height: 12px;
      stroke: white;
      fill: none;
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
      opacity: 0;
      transform: scale(0.5);
      transition: all var(--transition);
    }

    .addon.active .addon__checkbox svg {
      opacity: 1;
      transform: scale(1);
    }

    .addon__info {
      flex: 1;
      min-width: 0;
    }

    .addon__name {
      font-size: 0.9rem;
      font-weight: 500;
      line-height: 1.3;
    }

    .addon__desc {
      font-size: 0.78rem;
      color: var(--text-muted);
      line-height: 1.3;
    }

    .addon__price {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--accent);
      white-space: nowrap;
    }

    /* ===== Quote Card (right side) ===== */
    .quote-card {
      position: sticky;
      top: 2rem;
    }

    .quote-card .card {
      border-color: #2a2a40;
      background: linear-gradient(180deg, var(--bg-card) 0%, #13131e 100%);
    }

    /* ===== Price Breakdown ===== */
    .breakdown {
      margin-bottom: 1.5rem;
    }

    .breakdown__row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.6rem 0;
      font-size: 0.9rem;
    }

    .breakdown__row + .breakdown__row {
      border-top: 1px solid var(--border);
    }

    .breakdown__label {
      color: var(--text-secondary);
    }

    .breakdown__value {
      font-weight: 500;
    }

    .breakdown__row--addon .breakdown__label {
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }

    .breakdown__row--addon .breakdown__label::before {
      content: '+';
      color: var(--accent);
      font-weight: 600;
      font-size: 0.8rem;
    }

    /* ===== Divider ===== */
    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent 0%, var(--border) 50%, transparent 100%);
      margin: 1rem 0;
    }

    /* ===== Total ===== */
    .total {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-bottom: 1.5rem;
    }

    .total__label {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .total__amount {
      font-size: 2.25rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1;
      background: linear-gradient(135deg, #f0f0f5 0%, #c0c0d0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .total__amount.has-value {
      background: linear-gradient(135deg, var(--accent) 0%, #a78bfa 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* ===== Per sqft note ===== */
    .per-sqft {
      text-align: right;
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: -1rem;
      margin-bottom: 1.5rem;
    }

    /* ===== CTA Button ===== */
    .cta-btn {
      width: 100%;
      padding: 1rem;
      background: var(--accent);
      color: white;
      font-size: 1rem;
      font-weight: 600;
      font-family: inherit;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition);
      position: relative;
      overflow: hidden;
    }

    .cta-btn:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
      box-shadow: 0 4px 20px rgba(99, 102, 241, 0.4);
    }

    .cta-btn:active {
      transform: translateY(0);
    }

    /* ===== Savings Badge ===== */
    .savings-badge {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.65rem 1rem;
      background: var(--success-bg);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: var(--radius-md);
      margin-bottom: 1.25rem;
      opacity: 0;
      transform: translateY(-4px);
      transition: all 0.3s ease;
    }

    .savings-badge.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .savings-badge__icon {
      width: 18px;
      height: 18px;
      stroke: var(--success);
      fill: none;
      stroke-width: 2;
      flex-shrink: 0;
    }

    .savings-badge__text {
      font-size: 0.82rem;
      color: var(--success);
      font-weight: 500;
    }

    /* ===== Difficulty/complexity indicator ===== */
    .meta-row {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1.25rem;
      flex-wrap: wrap;
    }

    .meta-tag {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.35rem 0.75rem;
      background: var(--bg-input);
      border-radius: 999px;
      font-size: 0.78rem;
      color: var(--text-secondary);
    }

    .meta-tag__dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
    }

    /* ===== Animations ===== */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-in {
      animation: fadeInUp 0.5s ease forwards;
    }

    .animate-in:nth-child(1) { animation-delay: 0.05s; }
    .animate-in:nth-child(2) { animation-delay: 0.1s; }
    .animate-in:nth-child(3) { animation-delay: 0.15s; }

    /* ===== Number transition ===== */
    .price-animate {
      transition: all 0.3s ease;
    }

    /* ===== Footer ===== */
    .footer {
      text-align: center;
      margin-top: 3rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border);
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    /* ===== Tooltip / Info ===== */
    .info-note {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      padding: 0.75rem;
      background: var(--bg-input);
      border-radius: var(--radius-sm);
      margin-top: 1.25rem;
      font-size: 0.78rem;
      color: var(--text-muted);
      line-height: 1.4;
    }

    .info-note svg {
      width: 14px;
      height: 14px;
      stroke: var(--text-muted);
      fill: none;
      stroke-width: 2;
      flex-shrink: 0;
      margin-top: 1px;
    }

    /* ===== Empty state ===== */
    .empty-breakdown {
      text-align: center;
      padding: 1.5rem 0;
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    /* ===== Mobile adjustments ===== */
    @media (max-width: 720px) {
      .container {
        padding: 1.5rem 1rem 3rem;
      }

      .card {
        padding: 1.25rem;
      }

      .quote-card {
        position: static;
      }

      .total__amount {
        font-size: 1.85rem;
      }

      .header {
        margin-bottom: 2rem;
      }
    }

    @media (max-width: 380px) {
      .addon {
        flex-wrap: wrap;
      }

      .addon__price {
        margin-left: auto;
      }
    }

    /* ===== Scrollbar ===== */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-primary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #40405a;
    }
  </style>
</head>
<body>

<div class="container">
  <!-- Header -->
  <header class="header animate-in">
    <div class="header__logo">
      <div class="header__logo-icon">
        <svg viewBox="0 0 24 24"><path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
      </div>
      InspectorPro
    </div>
    <h1 class="header__title">Instant <span>Price Quote</span></h1>
    <p class="header__subtitle">Get an accurate estimate for your property cleaning project in seconds.</p>
  </header>

  <!-- Calculator -->
  <div class="calculator">
    <!-- Left Column: Inputs -->
    <div class="inputs-column">
      <!-- Project Details Card -->
      <div class="card animate-in" style="margin-bottom: 1.5rem;">
        <div class="card__title">
          <div class="card__title-icon">
            <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          </div>
          Project Details
        </div>

        <!-- Surface Type -->
        <div class="form-group">
          <label for="surfaceType">Surface Type</label>
          <div class="select-wrapper">
            <select id="surfaceType">
              <option value="">Select a surface...</option>
              <option value="driveway">Driveway / Concrete</option>
              <option value="house">House Wash (Siding)</option>
              <option value="roof">Roof Cleaning</option>
              <option value="patio">Patio / Deck</option>
              <option value="fence">Fence</option>
              <option value="garage">Garage Floor</option>
              <option value="commercial">Commercial Exterior</option>
              <option value="pool">Pool Deck</option>
            </select>
          </div>
        </div>

        <!-- Square Footage -->
        <div class="form-group">
          <label for="sqftInput">Square Footage</label>
          <div class="sqft-input-group">
            <input type="number" id="sqftInput" placeholder="e.g. 1500" min="0" max="50000" step="50">
            <span class="sqft-input-group__suffix">ft&sup2;</span>
          </div>
        </div>

        <!-- Quick Size Slider -->
        <div class="form-group">
          <div class="range-display">
            <label for="sqftRange" style="margin-bottom: 0;">Quick Size</label>
            <span class="range-display__value" id="rangeValue">0 ft&sup2;</span>
          </div>
          <input type="range" id="sqftRange" min="0" max="10000" step="100" value="0">
        </div>

        <div class="info-note">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          <span>Prices are estimates. Final cost may vary based on surface condition, accessibility, and job complexity.</span>
        </div>
      </div>

      <!-- Add-ons Card -->
      <div class="card animate-in">
        <div class="card__title">
          <div class="card__title-icon">
            <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          </div>
          Optional Add-ons
        </div>

        <div class="addons-list" id="addonsList">
          <!-- Add-ons are rendered by JS -->
        </div>
      </div>
    </div>

    <!-- Right Column: Quote -->
    <div class="quote-card animate-in">
      <div class="card">
        <div class="card__title">
          <div class="card__title-icon">
            <svg viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
          </div>
          Your Estimate
        </div>

        <!-- Meta tags -->
        <div class="meta-row" id="metaTags">
          <!-- Filled by JS -->
        </div>

        <!-- Savings badge -->
        <div class="savings-badge" id="savingsBadge">
          <svg class="savings-badge__icon" viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
          <span class="savings-badge__text" id="savingsText">Bundle savings applied!</span>
        </div>

        <!-- Breakdown -->
        <div class="breakdown" id="breakdown">
          <div class="empty-breakdown">Select a surface type and enter square footage to see your quote.</div>
        </div>

        <div class="divider"></div>

        <!-- Total -->
        <div class="total">
          <div class="total__label">Estimated Total</div>
          <div class="total__amount price-animate" id="totalAmount">$0</div>
        </div>

        <div class="per-sqft" id="perSqft"></div>

        <!-- CTA -->
        <button class="cta-btn" id="ctaBtn" onclick="handleGetQuote()">
          Get Detailed Quote
        </button>
      </div>
    </div>
  </div>

  <footer class="footer">
    InspectorPro &mdash; Professional Property Cleaning Estimates
  </footer>
</div>

<!-- Confirmation Modal -->
<div id="modal" style="display:none; position:fixed; inset:0; z-index:100; background:rgba(0,0,0,0.6); backdrop-filter:blur(4px); align-items:center; justify-content:center;">
  <div style="background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius-lg); padding:2rem; max-width:420px; width:90%; text-align:center; box-shadow:var(--shadow-lg);">
    <div style="width:48px; height:48px; background:var(--success-bg); border-radius:50%; display:flex; align-items:center; justify-content:center; margin:0 auto 1rem;">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
    </div>
    <h3 style="font-size:1.15rem; margin-bottom:0.5rem;">Quote Summary Ready</h3>
    <p style="color:var(--text-secondary); font-size:0.9rem; margin-bottom:1.5rem;" id="modalText">Your estimate has been calculated.</p>
    <button onclick="closeModal()" style="padding:0.65rem 2rem; background:var(--accent); color:white; border:none; border-radius:var(--radius-md); font-size:0.95rem; font-weight:600; cursor:pointer; font-family:inherit; transition:background var(--transition);" onmouseover="this.style.background='var(--accent-hover)'" onmouseout="this.style.background='var(--accent)'">Done</button>
  </div>
</div>

<script>
  // ===== Pricing Data =====
  const SURFACE_TYPES = {
    driveway:    { label: 'Driveway / Concrete', rate: 0.15, minCharge: 120, difficulty: 'Standard',  time: '2-4 hrs' },
    house:       { label: 'House Wash (Siding)',  rate: 0.25, minCharge: 200, difficulty: 'Moderate',  time: '3-5 hrs' },
    roof:        { label: 'Roof Cleaning',        rate: 0.35, minCharge: 300, difficulty: 'Complex',   time: '4-6 hrs' },
    patio:       { label: 'Patio / Deck',         rate: 0.18, minCharge: 100, difficulty: 'Standard',  time: '1-3 hrs' },
    fence:       { label: 'Fence',                rate: 0.12, minCharge: 100, difficulty: 'Standard',  time: '1-3 hrs' },
    garage:      { label: 'Garage Floor',         rate: 0.14, minCharge: 80,  difficulty: 'Easy',      time: '1-2 hrs' },
    commercial:  { label: 'Commercial Exterior',  rate: 0.30, minCharge: 500, difficulty: 'Complex',   time: '6-10 hrs' },
    pool:        { label: 'Pool Deck',            rate: 0.20, minCharge: 150, difficulty: 'Moderate',  time: '2-4 hrs' },
  };

  const ADDONS = [
    { id: 'sealant',     name: 'Surface Sealant',         desc: 'Protective coating after wash',     price: 150, pricingType: 'flat' },
    { id: 'stain',       name: 'Stain Treatment',          desc: 'Oil, rust & tough stain removal',   price: 0.05, pricingType: 'sqft' },
    { id: 'gutter',      name: 'Gutter Brightening',       desc: 'Clean exterior gutter faces',       price: 125, pricingType: 'flat' },
    { id: 'window',      name: 'Window Rinse',             desc: 'Exterior window spot-free rinse',   price: 75,  pricingType: 'flat' },
    { id: 'bio',         name: 'Bio-Wash Treatment',       desc: 'Mold & algae prevention coat',      price: 0.04, pricingType: 'sqft' },
    { id: 'rush',        name: 'Priority Scheduling',      desc: 'Guaranteed within 48 hours',        price: 100, pricingType: 'flat' },
  ];

  const BUNDLE_DISCOUNT_THRESHOLD = 3;
  const BUNDLE_DISCOUNT_PERCENT = 10;

  // ===== State =====
  let state = {
    surfaceType: '',
    sqft: 0,
    activeAddons: new Set(),
  };

  // ===== DOM Refs =====
  const surfaceSelect = document.getElementById('surfaceType');
  const sqftInput = document.getElementById('sqftInput');
  const sqftRange = document.getElementById('sqftRange');
  const rangeValue = document.getElementById('rangeValue');
  const addonsList = document.getElementById('addonsList');
  const breakdown = document.getElementById('breakdown');
  const totalAmount = document.getElementById('totalAmount');
  const perSqft = document.getElementById('perSqft');
  const metaTags = document.getElementById('metaTags');
  const savingsBadge = document.getElementById('savingsBadge');
  const savingsText = document.getElementById('savingsText');

  // ===== Initialize Add-ons =====
  function renderAddons() {
    addonsList.innerHTML = ADDONS.map(addon => `
      <div class="addon" data-id="${addon.id}" onclick="toggleAddon('${addon.id}')">
        <div class="addon__checkbox">
          <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
        </div>
        <div class="addon__info">
          <div class="addon__name">${addon.name}</div>
          <div class="addon__desc">${addon.desc}</div>
        </div>
        <div class="addon__price">${addon.pricingType === 'flat' ? '$' + addon.price : '$' + addon.price + '/ft\u00B2'}</div>
      </div>
    `).join('');
  }

  // ===== Toggle Add-on =====
  function toggleAddon(id) {
    if (state.activeAddons.has(id)) {
      state.activeAddons.delete(id);
    } else {
      state.activeAddons.add(id);
    }
    const el = addonsList.querySelector(`[data-id="${id}"]`);
    if (el) el.classList.toggle('active', state.activeAddons.has(id));
    calculate();
  }

  // ===== Calculation =====
  function calculate() {
    const surface = SURFACE_TYPES[state.surfaceType];
    const sqft = state.sqft;

    if (!surface || sqft <= 0) {
      breakdown.innerHTML = '<div class="empty-breakdown">Select a surface type and enter square footage to see your quote.</div>';
      totalAmount.textContent = '$0';
      totalAmount.classList.remove('has-value');
      perSqft.textContent = '';
      metaTags.innerHTML = '';
      savingsBadge.classList.remove('visible');
      return;
    }

    // Base price
    let basePrice = Math.max(surface.rate * sqft, surface.minCharge);

    // Add-on prices
    let addonDetails = [];
    let addonsTotal = 0;

    ADDONS.forEach(addon => {
      if (state.activeAddons.has(addon.id)) {
        let cost;
        if (addon.pricingType === 'sqft') {
          cost = addon.price * sqft;
        } else {
          cost = addon.price;
        }
        addonDetails.push({ name: addon.name, cost });
        addonsTotal += cost;
      }
    });

    // Bundle discount
    let discount = 0;
    let hasDiscount = state.activeAddons.size >= BUNDLE_DISCOUNT_THRESHOLD;
    if (hasDiscount) {
      discount = addonsTotal * (BUNDLE_DISCOUNT_PERCENT / 100);
    }

    let total = basePrice + addonsTotal - discount;

    // Build breakdown HTML
    let html = '';
    html += `<div class="breakdown__row">
      <span class="breakdown__label">${surface.label} (${sqft.toLocaleString()} ft&sup2;)</span>
      <span class="breakdown__value">$${basePrice.toFixed(2)}</span>
    </div>`;

    addonDetails.forEach(a => {
      html += `<div class="breakdown__row breakdown__row--addon">
        <span class="breakdown__label">${a.name}</span>
        <span class="breakdown__value">$${a.cost.toFixed(2)}</span>
      </div>`;
    });

    if (hasDiscount) {
      html += `<div class="breakdown__row">
        <span class="breakdown__label" style="color: var(--success);">Bundle Discount (${BUNDLE_DISCOUNT_PERCENT}%)</span>
        <span class="breakdown__value" style="color: var(--success);">-$${discount.toFixed(2)}</span>
      </div>`;
    }

    breakdown.innerHTML = html;

    // Total
    totalAmount.textContent = '$' + total.toFixed(2);
    totalAmount.classList.add('has-value');

    // Per sqft
    perSqft.textContent = '$' + (total / sqft).toFixed(2) + ' per ft\u00B2';

    // Meta tags
    metaTags.innerHTML = `
      <span class="meta-tag"><span class="meta-tag__dot"></span>${surface.difficulty}</span>
      <span class="meta-tag"><span class="meta-tag__dot" style="background: var(--warning);"></span>${surface.time}</span>
    `;

    // Savings badge
    if (hasDiscount) {
      savingsText.textContent = `Bundle savings: $${discount.toFixed(2)} off (${BUNDLE_DISCOUNT_PERCENT}% on add-ons)`;
      savingsBadge.classList.add('visible');
    } else {
      savingsBadge.classList.remove('visible');
    }
  }

  // ===== Event Listeners =====
  surfaceSelect.addEventListener('change', (e) => {
    state.surfaceType = e.target.value;
    calculate();
  });

  sqftInput.addEventListener('input', (e) => {
    const val = parseInt(e.target.value) || 0;
    state.sqft = Math.min(Math.max(val, 0), 50000);
    sqftRange.value = Math.min(state.sqft, 10000);
    rangeValue.textContent = state.sqft.toLocaleString() + ' ft\u00B2';
    calculate();
  });

  sqftRange.addEventListener('input', (e) => {
    const val = parseInt(e.target.value);
    state.sqft = val;
    sqftInput.value = val || '';
    rangeValue.textContent = val.toLocaleString() + ' ft\u00B2';
    calculate();
  });

  // ===== CTA =====
  function handleGetQuote() {
    const surface = SURFACE_TYPES[state.surfaceType];
    if (!surface || state.sqft <= 0) {
      alert('Please select a surface type and enter square footage.');
      return;
    }

    const totalText = totalAmount.textContent;
    const modal = document.getElementById('modal');
    const modalText = document.getElementById('modalText');
    modalText.textContent = `${surface.label} \u2014 ${state.sqft.toLocaleString()} ft\u00B2 \u2014 Estimated at ${totalText}`;
    modal.style.display = 'flex';
  }

  function closeModal() {
    document.getElementById('modal').style.display = 'none';
  }

  document.getElementById('modal').addEventListener('click', (e) => {
    if (e.target === e.currentTarget) closeModal();
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeModal();
  });

  // ===== Init =====
  renderAddons();
  calculate();
</script>

</body>
</html>
