<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NC Wash Works - Pricing Calculator</title>
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg-primary: #08080d;
      --bg-card: #111118;
      --bg-card-alt: #15151d;
      --bg-input: #1a1a24;
      --bg-hover: #1f1f2b;
      --border: #252535;
      --border-light: #2e2e40;
      --border-focus: #4A90D9;
      --text-primary: #ededf2;
      --text-secondary: #8e8ea6;
      --text-muted: #5c5c74;
      --accent: #4A90D9;
      --accent-soft: #6BB5E0;
      --accent-glow: rgba(74, 144, 217, 0.12);
      --accent-glow-md: rgba(74, 144, 217, 0.20);
      --green: #34d399;
      --green-soft: rgba(52, 211, 153, 0.10);
      --green-border: rgba(52, 211, 153, 0.18);
      --amber: #fbbf24;
      --amber-soft: rgba(251, 191, 36, 0.10);
      --amber-border: rgba(251, 191, 36, 0.25);
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --shadow-sm: 0 2px 8px rgba(0,0,0,0.15);
      --shadow-md: 0 4px 20px rgba(0,0,0,0.25);
      --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    html { font-size: 16px; scroll-behavior: smooth; }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background: radial-gradient(ellipse at 25% 0%, rgba(74, 144, 217, 0.05) 0%, transparent 60%),
                  radial-gradient(ellipse at 75% 100%, rgba(53, 120, 181, 0.03) 0%, transparent 60%);
      pointer-events: none;
    }

    /* ===== Layout ===== */
    .container {
      position: relative;
      z-index: 1;
      max-width: 1080px;
      margin: 0 auto;
      padding: 2.5rem 1.5rem 4rem;
    }

    .calculator {
      display: grid;
      grid-template-columns: 1fr 360px;
      gap: 2rem;
      align-items: start;
    }

    @media (max-width: 820px) {
      .calculator { grid-template-columns: 1fr; }
      .container { padding: 1.5rem 1rem 3rem; }
    }

    /* ===== Header ===== */
    .header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .header__brand {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    .header__brand-logo {
      height: 56px;
      width: auto;
      object-fit: contain;
      border-radius: 8px;
      filter: brightness(0.92) contrast(0.95) drop-shadow(0 0 18px rgba(74, 144, 217, 0.18));
      transition: filter 0.3s ease;
    }

    .header__brand-logo:hover {
      filter: brightness(1) contrast(1) drop-shadow(0 0 22px rgba(74, 144, 217, 0.28));
    }

    .header__brand-name {
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      color: var(--accent-soft);
    }

    @media (max-width: 820px) {
      .header__brand-logo { height: 46px; }
    }

    .header__title {
      font-size: clamp(1.6rem, 4.5vw, 2.25rem);
      font-weight: 700;
      letter-spacing: -0.025em;
      line-height: 1.15;
      margin-bottom: 0.6rem;
    }

    .header__title em {
      font-style: normal;
      background: linear-gradient(135deg, var(--accent) 0%, #6BB5E0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header__sub {
      color: var(--text-secondary);
      font-size: 0.95rem;
      max-width: 440px;
      margin: 0 auto;
    }

    /* ===== Card ===== */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.75rem;
    }

    .card + .card { margin-top: 1.25rem; }

    .card__heading {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 1.25rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--text-primary);
    }

    .card__heading-icon {
      width: 28px; height: 28px;
      background: var(--accent-glow);
      border-radius: var(--radius-sm);
      display: grid; place-items: center;
      flex-shrink: 0;
    }

    .card__heading-icon svg {
      width: 14px; height: 14px;
      stroke: var(--accent);
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    /* ===== Service Grid ===== */
    .services {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.5rem;
    }

    @media (max-width: 480px) {
      .services { grid-template-columns: 1fr; }
    }

    .service {
      position: relative;
      display: flex;
      align-items: center;
      gap: 0.65rem;
      padding: 0.85rem 1rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition);
      user-select: none;
      min-height: 52px;
      -webkit-tap-highlight-color: transparent;
    }

    .service:hover { background: var(--bg-hover); border-color: var(--border-light); }

    .service.active {
      background: var(--accent-glow);
      border-color: var(--accent);
    }

    .service__check {
      width: 22px; height: 22px;
      border: 2px solid var(--border-light);
      border-radius: 6px;
      display: grid; place-items: center;
      flex-shrink: 0;
      transition: all var(--transition);
    }

    .service.active .service__check {
      background: var(--accent);
      border-color: var(--accent);
    }

    .service__check svg {
      width: 12px; height: 12px;
      stroke: white; fill: none;
      stroke-width: 3;
      stroke-linecap: round;
      stroke-linejoin: round;
      opacity: 0;
      transform: scale(0.5);
      transition: all var(--transition);
    }

    .service.active .service__check svg {
      opacity: 1;
      transform: scale(1);
    }

    .service__body { flex: 1; min-width: 0; }

    .service__name {
      font-size: 0.85rem;
      font-weight: 500;
      line-height: 1.3;
    }

    .service__range {
      font-size: 0.72rem;
      color: var(--text-muted);
      line-height: 1.3;
    }

    /* ===== Stacked Service Configs ===== */
    .configs { margin-top: 1.25rem; }

    .config-item {
      background: var(--bg-card-alt);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 1rem 1.15rem;
      animation: slideIn 0.25s ease forwards;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }

    .config-item + .config-item { margin-top: 0.625rem; }

    .config-item--incomplete {
      border-color: var(--amber-border);
      box-shadow: 0 0 0 1px var(--amber-border);
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-6px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .config-item__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.75rem;
    }

    .config-item__title {
      font-size: 0.85rem;
      font-weight: 600;
    }

    .config-item__remove {
      width: 32px; height: 32px;
      background: none;
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-muted);
      cursor: pointer;
      display: grid; place-items: center;
      transition: all var(--transition);
      font-size: 0.85rem;
      line-height: 1;
      -webkit-tap-highlight-color: transparent;
    }

    .config-item__remove:hover {
      border-color: #ef4444;
      color: #ef4444;
      background: rgba(239, 68, 68, 0.08);
    }

    /* Size Selector */
    .size-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.4rem;
    }

    .size-btn {
      position: relative;
      padding: 0.65rem 0.5rem;
      background: var(--bg-input);
      border: 1.5px solid var(--border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      text-align: center;
      transition: all var(--transition);
      font-family: inherit;
      color: var(--text-primary);
      min-height: 48px;
      -webkit-tap-highlight-color: transparent;
    }

    .size-btn:hover { border-color: var(--border-light); background: var(--bg-hover); }

    .size-btn.active {
      border-color: var(--accent);
      background: var(--accent-glow);
    }

    .size-btn__label {
      display: block;
      font-size: 0.68rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 0.15rem;
    }

    .size-btn.active .size-btn__label { color: var(--accent-soft); }

    .size-btn__price {
      display: block;
      font-size: 0.88rem;
      font-weight: 700;
      line-height: 1.2;
    }

    .size-btn__sqft {
      display: block;
      font-size: 0.65rem;
      color: var(--text-muted);
      margin-top: 0.1rem;
    }

    .size-btn__popular {
      position: absolute;
      top: -7px;
      left: 50%;
      transform: translateX(-50%);
      padding: 0.05rem 0.5rem;
      background: var(--accent);
      color: white;
      font-size: 0.58rem;
      font-weight: 700;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      border-radius: 999px;
      white-space: nowrap;
    }

    .size-btn--popular { border-color: rgba(74, 144, 217, 0.35); }

    /* ===== Condition Buttons ===== */
    .condition-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0.5rem;
    }

    .condition-btn {
      padding: 0.75rem 0.5rem;
      background: var(--bg-input);
      border: 1.5px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      text-align: center;
      transition: all var(--transition);
      font-family: inherit;
      color: var(--text-primary);
      min-height: 52px;
      -webkit-tap-highlight-color: transparent;
    }

    .condition-btn:hover { border-color: var(--border-light); background: var(--bg-hover); }

    .condition-btn.active {
      border-color: var(--accent);
      background: var(--accent-glow);
    }

    .condition-btn__label {
      display: block;
      font-size: 0.78rem;
      font-weight: 600;
      line-height: 1.3;
    }

    .condition-btn__adj {
      display: block;
      font-size: 0.66rem;
      color: var(--text-muted);
      margin-top: 0.1rem;
    }

    .condition-btn.active .condition-btn__adj { color: var(--accent-soft); }

    /* Condition info toggle */
    .condition-info-btn {
      width: 22px; height: 22px;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 50%;
      color: var(--text-muted);
      font-size: 0.7rem;
      font-weight: 700;
      cursor: pointer;
      display: inline-grid;
      place-items: center;
      margin-left: auto;
      transition: all var(--transition);
      -webkit-tap-highlight-color: transparent;
      font-family: inherit;
      line-height: 1;
    }

    .condition-info-btn:hover { border-color: var(--accent); color: var(--accent-soft); }

    .condition-info {
      margin-top: 0.75rem;
      padding: 0.65rem 0.85rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 0.72rem;
      color: var(--text-secondary);
      line-height: 1.55;
    }

    .condition-info dt {
      font-weight: 600;
      color: var(--text-primary);
      display: inline;
    }

    .condition-info dd {
      display: inline;
      margin: 0;
    }

    .condition-info dd::after {
      content: '';
      display: block;
      margin-bottom: 0.2rem;
    }

    .condition-info dd:last-child::after { margin-bottom: 0; }

    /* ===== Context hint under configs ===== */
    .context-hint {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 0.875rem;
      padding: 0.55rem 0.75rem;
      background: var(--accent-glow);
      border-radius: var(--radius-sm);
      font-size: 0.73rem;
      color: var(--text-secondary);
      line-height: 1.35;
    }

    .context-hint svg {
      width: 13px; height: 13px;
      stroke: var(--accent-soft);
      fill: none;
      stroke-width: 2;
      flex-shrink: 0;
    }

    /* ===== Add-ons ===== */
    .addons { display: flex; flex-direction: column; gap: 0.5rem; }

    .addon {
      display: flex;
      align-items: center;
      gap: 0.65rem;
      padding: 0.75rem 1rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition);
      user-select: none;
      min-height: 52px;
      -webkit-tap-highlight-color: transparent;
    }

    .addon:hover { background: var(--bg-hover); border-color: var(--border-light); }
    .addon.active { background: var(--accent-glow); border-color: var(--accent); }

    .addon__check {
      width: 22px; height: 22px;
      border: 2px solid var(--border-light);
      border-radius: 6px;
      display: grid; place-items: center;
      flex-shrink: 0;
      transition: all var(--transition);
    }

    .addon.active .addon__check { background: var(--accent); border-color: var(--accent); }

    .addon__check svg {
      width: 12px; height: 12px;
      stroke: white; fill: none;
      stroke-width: 3;
      stroke-linecap: round; stroke-linejoin: round;
      opacity: 0; transform: scale(0.5);
      transition: all var(--transition);
    }

    .addon.active .addon__check svg { opacity: 1; transform: scale(1); }

    .addon__body { flex: 1; min-width: 0; }
    .addon__name { font-size: 0.85rem; font-weight: 500; line-height: 1.3; }
    .addon__desc { font-size: 0.7rem; color: var(--text-muted); line-height: 1.3; }

    .addon__price {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--accent-soft);
      white-space: nowrap;
    }

    /* ===== Quote Panel ===== */
    .quote-panel { position: sticky; top: 2rem; }

    @media (max-width: 820px) { .quote-panel { position: static; } }

    .quote-panel .card {
      background: linear-gradient(180deg, var(--bg-card) 0%, #0e0e16 100%);
      border-color: #2a2a3e;
    }

    .quote-empty {
      text-align: center;
      padding: 2rem 1rem;
      color: var(--text-muted);
      font-size: 0.82rem;
      line-height: 1.5;
    }

    /* Panel top row (heading + reset) */
    .panel-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.25rem;
    }

    .panel-top .card__heading { margin-bottom: 0; }

    .reset-btn {
      display: flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.35rem 0.65rem;
      background: none;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-family: inherit;
      font-size: 0.68rem;
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      transition: all var(--transition);
      min-height: 32px;
      -webkit-tap-highlight-color: transparent;
    }

    .reset-btn:hover { border-color: var(--border-light); color: var(--text-secondary); }

    .reset-btn svg {
      width: 12px; height: 12px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    /* ===== View Toggle ===== */
    .view-toggle {
      display: flex;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 3px;
      margin-bottom: 1.25rem;
    }

    .view-toggle__btn {
      flex: 1;
      padding: 0.55rem 0.5rem;
      background: none;
      border: none;
      border-radius: 6px;
      font-family: inherit;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-muted);
      cursor: pointer;
      transition: all var(--transition);
      min-height: 40px;
      -webkit-tap-highlight-color: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
    }

    .view-toggle__btn:hover { color: var(--text-secondary); }

    .view-toggle__btn.active {
      background: var(--accent-glow-md);
      color: var(--accent-soft);
    }

    .view-toggle__btn svg {
      width: 13px; height: 13px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      flex-shrink: 0;
    }

    /* Breakdown */
    .breakdown { margin-bottom: 1rem; }

    .bk-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      font-size: 0.82rem;
    }

    .bk-row + .bk-row { border-top: 1px solid var(--border); }

    .bk-label { color: var(--text-secondary); }
    .bk-value { font-weight: 500; white-space: nowrap; }

    .bk-row--service .bk-label {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }

    .bk-dot {
      width: 5px; height: 5px;
      border-radius: 50%;
      background: var(--accent);
      flex-shrink: 0;
    }

    .bk-row--addon .bk-label::before {
      content: '+';
      color: var(--accent-soft);
      font-weight: 600;
      font-size: 0.75rem;
      margin-right: 0.25rem;
    }

    /* Multi-service badge */
    .bundle-note {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.5rem 0.75rem;
      background: var(--green-soft);
      border: 1px solid var(--green-border);
      border-radius: var(--radius-sm);
      margin-bottom: 1rem;
      font-size: 0.75rem;
      color: var(--green);
      font-weight: 500;
      opacity: 0;
      max-height: 0;
      padding-top: 0;
      padding-bottom: 0;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .bundle-note.visible {
      opacity: 1;
      max-height: 50px;
      padding: 0.5rem 0.75rem;
    }

    .bundle-note svg {
      width: 13px; height: 13px;
      stroke: var(--green);
      fill: none; stroke-width: 2;
      flex-shrink: 0;
    }

    /* Incomplete notice */
    .incomplete-notice {
      padding: 0.6rem 0.75rem;
      background: var(--amber-soft);
      border: 1px solid var(--amber-border);
      border-radius: var(--radius-sm);
      margin-bottom: 1rem;
      font-size: 0.73rem;
      color: var(--amber);
      line-height: 1.4;
    }

    /* Divider */
    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border), transparent);
      margin: 0.75rem 0;
    }

    /* Total */
    .total-row {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      margin-bottom: 0.2rem;
    }

    .total-label {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .total-amount {
      font-size: 1.75rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      line-height: 1;
      background: linear-gradient(135deg, #d0d0e0 0%, #9090a0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      transition: all 0.3s ease;
    }

    .total-amount.live {
      background: linear-gradient(135deg, var(--accent) 0%, #6BB5E0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .total-context {
      text-align: right;
      font-size: 0.7rem;
      color: var(--text-muted);
      min-height: 1em;
    }

    .total-disclaimer {
      text-align: right;
      font-size: 0.65rem;
      color: var(--text-muted);
      opacity: 0.7;
      margin-bottom: 1.25rem;
      line-height: 1.4;
    }

    /* ===== Details Expander (Customer View) ===== */
    .details-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.35rem;
      width: 100%;
      padding: 0.5rem;
      background: none;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-family: inherit;
      font-size: 0.72rem;
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      transition: all var(--transition);
      margin-bottom: 0.75rem;
      -webkit-tap-highlight-color: transparent;
    }

    .details-toggle:hover { border-color: var(--border-light); color: var(--text-secondary); }

    .details-toggle svg {
      width: 12px; height: 12px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
      transition: transform var(--transition);
    }

    .details-toggle.open svg { transform: rotate(180deg); }

    .details-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease;
    }

    .details-content.open {
      max-height: 500px;
    }

    /* CTA / Copy */
    .cta {
      width: 100%;
      padding: 0.9rem 1rem;
      background: var(--accent);
      color: white;
      font-size: 0.88rem;
      font-weight: 600;
      font-family: inherit;
      border: none;
      border-radius: var(--radius-md);
      cursor: pointer;
      transition: all var(--transition);
      min-height: 52px;
      -webkit-tap-highlight-color: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.4rem;
    }

    .cta:hover {
      background: var(--accent-soft);
      transform: translateY(-1px);
      box-shadow: 0 4px 20px rgba(74, 144, 217, 0.3);
    }

    .cta:active { transform: translateY(0); }

    .cta:disabled {
      opacity: 0.35;
      cursor: not-allowed;
      transform: none !important;
      box-shadow: none !important;
    }

    .cta:disabled:hover { background: var(--accent); }

    .cta svg {
      width: 16px; height: 16px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
      flex-shrink: 0;
    }

    /* Trust */
    .trust-row {
      display: flex;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
      padding-top: 0.85rem;
      border-top: 1px solid var(--border);
      flex-wrap: wrap;
    }

    .trust-item {
      display: flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    .trust-item svg {
      width: 11px; height: 11px;
      stroke: var(--text-muted); fill: none;
      stroke-width: 2;
      stroke-linecap: round; stroke-linejoin: round;
    }

    /* ===== Footer ===== */
    .footer {
      text-align: center;
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid var(--border);
      font-size: 0.72rem;
      color: var(--text-muted);
    }

    /* ===== Animations ===== */
    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(10px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .fade-up {
      animation: fadeUp 0.4s ease forwards;
    }

    .fade-up:nth-child(2) { animation-delay: 0.06s; }
    .fade-up:nth-child(3) { animation-delay: 0.12s; }

    /* ===== Scrollbar ===== */
    ::-webkit-scrollbar { width: 7px; }
    ::-webkit-scrollbar-track { background: var(--bg-primary); }
    ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #3a3a50; }

    /* ===== Modal ===== */
    .modal-overlay {
      display: none;
      position: fixed;
      inset: 0;
      z-index: 100;
      background: rgba(0,0,0,0.55);
      backdrop-filter: blur(4px);
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.open { display: flex; }

    .modal-box {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 2rem;
      max-width: 420px;
      width: 90%;
      text-align: center;
      box-shadow: var(--shadow-md);
    }

    .modal-title { font-size: 1.05rem; font-weight: 600; margin-bottom: 0.75rem; }
    .modal-desc { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem; }

    .modal-actions {
      display: flex;
      gap: 0.5rem;
      justify-content: center;
    }

    .modal-actions button {
      flex: 1;
      max-width: 160px;
      padding: 0.6rem 1rem;
      border-radius: var(--radius-sm);
      font-family: inherit;
      font-size: 0.85rem;
      font-weight: 600;
      cursor: pointer;
      min-height: 44px;
      -webkit-tap-highlight-color: transparent;
      transition: all var(--transition);
    }

    .modal-cancel {
      background: var(--bg-input);
      border: 1px solid var(--border);
      color: var(--text-secondary);
    }

    .modal-cancel:hover { border-color: var(--border-light); color: var(--text-primary); }

    .modal-confirm {
      background: var(--accent);
      border: none;
      color: white;
    }

    .modal-confirm:hover { background: var(--accent-soft); }

    .modal-confirm--danger {
      background: #ef4444;
    }

    .modal-confirm--danger:hover { background: #f87171; }

    /* PIN input */
    .pin-input {
      width: 140px;
      padding: 0.7rem 1rem;
      background: var(--bg-input);
      border: 1.5px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-family: inherit;
      font-size: 1.2rem;
      font-weight: 700;
      text-align: center;
      letter-spacing: 0.3em;
      margin: 0 auto 0.5rem;
      display: block;
      -webkit-tap-highlight-color: transparent;
      transition: border-color var(--transition);
    }

    .pin-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .pin-input.error {
      border-color: #ef4444;
      animation: shake 0.3s ease;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-6px); }
      75% { transform: translateX(6px); }
    }

    .pin-error {
      font-size: 0.75rem;
      color: #ef4444;
      margin-bottom: 0.75rem;
      min-height: 1.2em;
    }

    /* Lock btn in operator view */
    .lock-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.3rem;
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.75rem;
      background: none;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-family: inherit;
      font-size: 0.72rem;
      font-weight: 500;
      color: var(--text-muted);
      cursor: pointer;
      transition: all var(--transition);
      min-height: 38px;
      -webkit-tap-highlight-color: transparent;
    }

    .lock-btn:hover { border-color: var(--border-light); color: var(--text-secondary); }

    .lock-btn svg {
      width: 12px; height: 12px;
      stroke: currentColor;
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    /* Clipboard fallback */
    .clipboard-textarea {
      width: 100%;
      min-height: 180px;
      padding: 0.75rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text-primary);
      font-family: 'SF Mono', 'Fira Code', monospace;
      font-size: 0.72rem;
      line-height: 1.5;
      resize: none;
      margin-bottom: 1rem;
    }

    .clipboard-textarea:focus { outline: none; border-color: var(--accent); }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      padding: 0.65rem 1.5rem;
      background: var(--green);
      color: #08080d;
      font-size: 0.82rem;
      font-weight: 600;
      border-radius: 999px;
      z-index: 200;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s ease;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  </style>
</head>
<body>

<div class="container">

  <header class="header fade-up">
    <div class="header__brand">
      <img src="./logo.png" alt="NC Wash Works" class="header__brand-logo">
      <span class="header__brand-name">NC Wash Works</span>
    </div>
    <h1 class="header__title">Build Your <em>Custom Quote</em></h1>
    <p class="header__sub">Select one or more services below. We'll calculate everything instantly.</p>
  </header>

  <div class="calculator">
    <!-- Left Column -->
    <div class="left-col">

      <!-- Services -->
      <div class="card fade-up">
        <div class="card__heading">
          <div class="card__heading-icon">
            <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
          </div>
          Services
        </div>

        <div class="services" id="serviceGrid"></div>

        <!-- Stacked configs appear here -->
        <div class="configs" id="configs"></div>

        <div class="context-hint" id="contextHint" style="display:none;">
          <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
          <span id="contextHintText"></span>
        </div>
      </div>

      <!-- Surface Condition -->
      <div class="card fade-up">
        <div class="card__heading">
          <div class="card__heading-icon">
            <svg viewBox="0 0 24 24"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          </div>
          Surface Condition
          <button class="condition-info-btn" onclick="toggleConditionInfo()" title="What do these mean?">?</button>
        </div>
        <div id="conditionInfo" style="display:none;" class="condition-info">
          <dl>
            <dt>Normal:</dt> <dd>Standard cleaning, no special treatment needed.</dd>
            <dt>Heavy Mildew:</dt> <dd>More dwell time and treatment required (+12%).</dd>
            <dt>Oxidation / Extra Prep:</dt> <dd>Additional prep work and surface risk (+20%).</dd>
          </dl>
        </div>
        <div class="condition-row" id="conditionRow"></div>
      </div>

      <!-- Add-ons -->
      <div class="card fade-up">
        <div class="card__heading">
          <div class="card__heading-icon">
            <svg viewBox="0 0 24 24"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          </div>
          Extras
        </div>
        <div class="addons" id="addons"></div>
      </div>

    </div>

    <!-- Right Column: Quote Panel -->
    <div class="quote-panel fade-up">
      <div class="card">
        <div class="panel-top">
          <div class="card__heading">
            <div class="card__heading-icon">
              <svg viewBox="0 0 24 24"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/></svg>
            </div>
            Your Estimate
          </div>
          <button class="reset-btn" onclick="promptReset()">
            <svg viewBox="0 0 24 24"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 102.13-9.36L1 10"/></svg>
            Reset
          </button>
        </div>

        <!-- View Toggle -->
        <div class="view-toggle">
          <button class="view-toggle__btn active" id="viewCustomer" onclick="setView('customer')">Customer View</button>
          <button class="view-toggle__btn" id="viewOperator" onclick="handleOperatorToggle()">
            <svg viewBox="0 0 24 24" id="operatorLockIcon"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
            <span id="operatorBtnLabel">Operator View</span>
          </button>
        </div>

        <div class="bundle-note" id="bundleNote">
          <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
          <span id="bundleNoteText"></span>
        </div>

        <!-- Incomplete services notice -->
        <div class="incomplete-notice" id="incompleteNotice" style="display:none;"></div>

        <!-- Customer view: typical estimate prominent -->
        <div id="customerView">
          <div class="breakdown" id="breakdownCustomer">
            <div class="quote-empty">Select a service to get started.</div>
          </div>

          <div class="divider"></div>

          <div class="total-row">
            <span class="total-label">Typical Estimate</span>
            <span class="total-amount" id="totalTypical">&mdash;</span>
          </div>
          <div class="total-context" id="totalContextCustomer"></div>
          <div class="total-disclaimer" id="disclaimerCustomer"></div>

          <!-- Expandable details -->
          <button class="details-toggle" id="detailsToggle" onclick="toggleDetails()" style="display:none;">
            View Full Range
            <svg viewBox="0 0 24 24"><polyline points="6 9 12 15 18 9"/></svg>
          </button>
          <div class="details-content" id="detailsContent">
            <div class="breakdown" id="breakdownDetails"></div>
            <div style="height:0.5rem;"></div>
          </div>
        </div>

        <!-- Operator view: full breakdown -->
        <div id="operatorView" style="display:none;">
          <div class="breakdown" id="breakdownOperator">
            <div class="quote-empty">Select a service to get started.</div>
          </div>

          <div class="divider"></div>

          <div class="total-row">
            <span class="total-label">Estimated Range</span>
            <span class="total-amount" id="totalRange">&mdash;</span>
          </div>
          <div class="total-context" id="totalContextOperator"></div>
          <div class="total-disclaimer" id="disclaimerOperator"></div>
        </div>

        <button class="cta" id="cta" disabled onclick="handleCta()">
          <svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
          <span id="ctaLabel">Copy Quote Summary</span>
        </button>

        <!-- Lock button (only visible in operator view) -->
        <button class="lock-btn" id="lockBtn" onclick="lockOperator()" style="display:none;">
          <svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
          Lock Operator View
        </button>

        <div class="trust-row">
          <span class="trust-item">
            <svg viewBox="0 0 24 24"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
            No payment needed
          </span>
          <span class="trust-item">
            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
            Price-match guarantee
          </span>
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">NC Wash Works &mdash; Professional Property Cleaning</footer>
</div>

<!-- PIN Modal -->
<div class="modal-overlay" id="pinModal">
  <div class="modal-box">
    <div class="modal-title">Enter Operator PIN</div>
    <input class="pin-input" id="pinInput" type="password" inputmode="numeric" pattern="[0-9]*" maxlength="4" autocomplete="off" placeholder="----">
    <div class="pin-error" id="pinError">&nbsp;</div>
    <div class="modal-actions">
      <button class="modal-cancel" onclick="closePinModal()">Cancel</button>
      <button class="modal-confirm" onclick="submitPin()">Unlock</button>
    </div>
  </div>
</div>

<!-- Reset Modal -->
<div class="modal-overlay" id="resetModal">
  <div class="modal-box">
    <div class="modal-title">Reset this quote?</div>
    <div class="modal-desc">All selections will be cleared.</div>
    <div class="modal-actions">
      <button class="modal-cancel" onclick="closeResetModal()">Cancel</button>
      <button class="modal-confirm modal-confirm--danger" onclick="confirmReset()">Reset</button>
    </div>
  </div>
</div>

<!-- Clipboard Fallback Modal -->
<div class="modal-overlay" id="clipboardModal">
  <div class="modal-box">
    <div class="modal-title">Quote Summary</div>
    <textarea class="clipboard-textarea" id="clipboardText" readonly></textarea>
    <div class="modal-actions">
      <button class="modal-confirm" onclick="selectAllClipboard()">Select All</button>
      <button class="modal-cancel" onclick="closeClipboardModal()">Close</button>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" id="toast">Copied to clipboard</div>

<script>
// =====================================================================
// DATA
// =====================================================================
const SERVICES = {
  driveway:   { name: 'Driveway / Concrete',  tiers: { small: { sqft: 'Up to 500 ft\u00B2',          low: 120, high: 200 }, standard: { sqft: '500\u20131,500 ft\u00B2',    low: 200, high: 350 }, large: { sqft: '1,500+ ft\u00B2',   low: 350, high: 600 } } },
  house:      { name: 'House Wash',            tiers: { small: { sqft: 'Up to 1,000 ft\u00B2',        low: 200, high: 350 }, standard: { sqft: '1,000\u20132,500 ft\u00B2',  low: 350, high: 625 }, large: { sqft: '2,500+ ft\u00B2',   low: 625, high: 1000 } } },
  roof:       { name: 'Roof Cleaning',         tiers: { small: { sqft: 'Up to 1,000 ft\u00B2',        low: 300, high: 450 }, standard: { sqft: '1,000\u20132,000 ft\u00B2',  low: 450, high: 700 }, large: { sqft: '2,000+ ft\u00B2',   low: 700, high: 1200 } } },
  patio:      { name: 'Patio / Deck',          tiers: { small: { sqft: 'Up to 300 ft\u00B2',          low: 100, high: 175 }, standard: { sqft: '300\u2013800 ft\u00B2',      low: 175, high: 300 }, large: { sqft: '800+ ft\u00B2',     low: 300, high: 500 } } },
  fence:      { name: 'Fence',                 tiers: { small: { sqft: 'Up to 200 ft\u00B2',          low: 100, high: 150 }, standard: { sqft: '200\u2013600 ft\u00B2',      low: 150, high: 250 }, large: { sqft: '600+ ft\u00B2',     low: 250, high: 400 } } },
  garage:     { name: 'Garage Floor',          tiers: { small: { sqft: 'Up to 300 ft\u00B2',          low: 80,  high: 130 }, standard: { sqft: '300\u2013600 ft\u00B2',      low: 130, high: 200 }, large: { sqft: '600+ ft\u00B2',     low: 200, high: 350 } } },
  commercial: { name: 'Commercial Exterior',   tiers: { small: { sqft: 'Up to 2,000 ft\u00B2',        low: 500, high: 800 }, standard: { sqft: '2,000\u20135,000 ft\u00B2',  low: 800, high: 1500 }, large: { sqft: '5,000+ ft\u00B2', low: 1500, high: 2500 } } },
  pool:       { name: 'Pool Deck',             tiers: { small: { sqft: 'Up to 400 ft\u00B2',          low: 150, high: 225 }, standard: { sqft: '400\u20131,000 ft\u00B2',    low: 225, high: 400 }, large: { sqft: '1,000+ ft\u00B2',   low: 400, high: 650 } } },
};

const ADDONS = [
  { id: 'sealant', name: 'Surface Sealant',    desc: 'Protective coating after wash',   price: 150 },
  { id: 'stain',   name: 'Stain Treatment',     desc: 'Oil, rust & tough stain removal',  price: 125 },
  { id: 'gutter',  name: 'Gutter Brightening',  desc: 'Clean exterior gutter faces',      price: 125 },
  { id: 'window',  name: 'Window Rinse',        desc: 'Exterior window spot-free rinse',  price: 75 },
  { id: 'bio',     name: 'Bio-Wash Treatment',  desc: 'Mold & algae prevention coat',     price: 100 },
  { id: 'rush',    name: 'Priority Scheduling', desc: 'Guaranteed within 48 hours',       price: 100 },
];

const BUNDLE_DISCOUNTS = [
  { min: 4, pct: 15, label: 'Whole-property package' },
  { min: 3, pct: 12, label: 'Multi-service bundle' },
  { min: 2, pct: 8,  label: 'Two-service bundle' },
];

const CONDITIONS = [
  { id: 'normal',    label: 'Normal',                 adj: 'Standard cleaning', pct: 0 },
  { id: 'mildew',    label: 'Heavy Mildew',           adj: 'More dwell time (+12%)', pct: 12 },
  { id: 'oxidation', label: 'Oxidation / Extra Prep', adj: 'Extra prep & risk (+20%)', pct: 20 },
];

const OPERATOR_PIN = '0420';
const DISCLAIMER = 'Final price confirmed after on-site inspection (access, staining, surface condition).';

// =====================================================================
// STATE
// =====================================================================
let state = {
  selectedServices: {},
  activeAddons: new Set(),
  condition: 'normal',
  viewMode: 'customer',
  detailsOpen: false,
  operatorUnlocked: false,
  conditionInfoOpen: false,
};

// =====================================================================
// DOM REFS
// =====================================================================
const serviceGrid     = document.getElementById('serviceGrid');
const configsEl       = document.getElementById('configs');
const addonsEl        = document.getElementById('addons');
const conditionRowEl  = document.getElementById('conditionRow');
const bundleNote      = document.getElementById('bundleNote');
const bundleNoteText  = document.getElementById('bundleNoteText');
const contextHint     = document.getElementById('contextHint');
const contextHintText = document.getElementById('contextHintText');
const ctaEl           = document.getElementById('cta');
const ctaLabel        = document.getElementById('ctaLabel');
const incompleteNotice= document.getElementById('incompleteNotice');

const customerView           = document.getElementById('customerView');
const breakdownCustomerEl    = document.getElementById('breakdownCustomer');
const totalTypicalEl         = document.getElementById('totalTypical');
const totalContextCustomerEl = document.getElementById('totalContextCustomer');
const disclaimerCustomerEl   = document.getElementById('disclaimerCustomer');
const detailsToggleEl        = document.getElementById('detailsToggle');
const detailsContentEl       = document.getElementById('detailsContent');
const breakdownDetailsEl     = document.getElementById('breakdownDetails');

const operatorView           = document.getElementById('operatorView');
const breakdownOperatorEl    = document.getElementById('breakdownOperator');
const totalRangeEl           = document.getElementById('totalRange');
const totalContextOperatorEl = document.getElementById('totalContextOperator');
const disclaimerOperatorEl   = document.getElementById('disclaimerOperator');

const viewCustomerBtn  = document.getElementById('viewCustomer');
const viewOperatorBtn  = document.getElementById('viewOperator');
const operatorLockIcon = document.getElementById('operatorLockIcon');
const operatorBtnLabel = document.getElementById('operatorBtnLabel');
const lockBtn          = document.getElementById('lockBtn');

const pinModal   = document.getElementById('pinModal');
const pinInput   = document.getElementById('pinInput');
const pinError   = document.getElementById('pinError');
const resetModal = document.getElementById('resetModal');
const clipModal  = document.getElementById('clipboardModal');
const clipText   = document.getElementById('clipboardText');
const toastEl    = document.getElementById('toast');

function fmt(n) { return '$' + Math.round(n).toLocaleString(); }

// =====================================================================
// TOAST
// =====================================================================
let toastTimer = null;
function showToast(msg) {
  toastEl.textContent = msg || 'Copied to clipboard';
  toastEl.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => toastEl.classList.remove('show'), 2000);
}

// =====================================================================
// A) OPERATOR PIN GATE
// =====================================================================
function handleOperatorToggle() {
  if (state.viewMode === 'operator') {
    setView('customer');
    return;
  }
  if (state.operatorUnlocked) {
    setView('operator');
  } else {
    openPinModal();
  }
}

function openPinModal() {
  pinInput.value = '';
  pinError.innerHTML = '&nbsp;';
  pinInput.classList.remove('error');
  pinModal.classList.add('open');
  setTimeout(() => pinInput.focus(), 100);
}

function closePinModal() {
  pinModal.classList.remove('open');
}

function submitPin() {
  if (pinInput.value === OPERATOR_PIN) {
    state.operatorUnlocked = true;
    closePinModal();
    updateOperatorBtnUI();
    setView('operator');
  } else {
    pinError.textContent = 'Incorrect PIN';
    pinInput.classList.add('error');
    pinInput.value = '';
    setTimeout(() => pinInput.classList.remove('error'), 400);
    setTimeout(() => pinInput.focus(), 100);
  }
}

function lockOperator() {
  state.operatorUnlocked = false;
  updateOperatorBtnUI();
  setView('customer');
}

function updateOperatorBtnUI() {
  if (state.operatorUnlocked) {
    operatorLockIcon.style.display = 'none';
  } else {
    operatorLockIcon.style.display = '';
  }
}

pinInput.addEventListener('keydown', e => {
  if (e.key === 'Enter') submitPin();
  if (e.key === 'Escape') closePinModal();
});

pinModal.addEventListener('click', e => { if (e.target === pinModal) closePinModal(); });

// =====================================================================
// VIEW TOGGLE
// =====================================================================
function setView(mode) {
  state.viewMode = mode;
  viewCustomerBtn.classList.toggle('active', mode === 'customer');
  viewOperatorBtn.classList.toggle('active', mode === 'operator');
  customerView.style.display = mode === 'customer' ? '' : 'none';
  operatorView.style.display = mode === 'operator' ? '' : 'none';
  lockBtn.style.display = (mode === 'operator') ? '' : 'none';
  calculate();
}

// =====================================================================
// DETAILS EXPANDER
// =====================================================================
function toggleDetails() {
  state.detailsOpen = !state.detailsOpen;
  detailsToggleEl.classList.toggle('open', state.detailsOpen);
  detailsContentEl.classList.toggle('open', state.detailsOpen);
  detailsToggleEl.childNodes[0].textContent = state.detailsOpen ? 'Hide Full Range ' : 'View Full Range ';
}

// =====================================================================
// CONDITION INFO TOGGLE
// =====================================================================
function toggleConditionInfo() {
  state.conditionInfoOpen = !state.conditionInfoOpen;
  document.getElementById('conditionInfo').style.display = state.conditionInfoOpen ? '' : 'none';
}

// =====================================================================
// D) RESET
// =====================================================================
function promptReset() {
  const hasSelections = Object.keys(state.selectedServices).length > 0 || state.activeAddons.size > 0 || state.condition !== 'normal';
  if (!hasSelections) return;
  resetModal.classList.add('open');
}

function closeResetModal() { resetModal.classList.remove('open'); }

function confirmReset() {
  state.selectedServices = {};
  state.activeAddons = new Set();
  state.condition = 'normal';
  state.detailsOpen = false;
  state.conditionInfoOpen = false;
  document.getElementById('conditionInfo').style.display = 'none';
  detailsToggleEl.classList.remove('open');
  detailsContentEl.classList.remove('open');

  if (state.viewMode === 'operator') {
    state.operatorUnlocked = false;
    updateOperatorBtnUI();
    setView('customer');
  }

  closeResetModal();
  renderServiceGrid();
  renderConfigs();
  renderConditions();
  renderAddons();
  calculate();
}

resetModal.addEventListener('click', e => { if (e.target === resetModal) closeResetModal(); });

// =====================================================================
// RENDER: Service Grid
// =====================================================================
function renderServiceGrid() {
  const keys = Object.keys(SERVICES);
  serviceGrid.innerHTML = keys.map(key => {
    const s = SERVICES[key];
    const isActive = key in state.selectedServices;
    const stdTier = s.tiers.standard;
    return `
      <div class="service${isActive ? ' active' : ''}" onclick="toggleService('${key}')">
        <div class="service__check">
          <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
        </div>
        <div class="service__body">
          <div class="service__name">${s.name}</div>
          <div class="service__range">${fmt(stdTier.low)} \u2013 ${fmt(stdTier.high)}</div>
        </div>
      </div>`;
  }).join('');
}

// =====================================================================
// RENDER: Stacked Config Cards
// =====================================================================
function renderConfigs() {
  const keys = Object.keys(state.selectedServices);
  if (keys.length === 0) {
    configsEl.innerHTML = '';
    contextHint.style.display = 'none';
    return;
  }

  configsEl.innerHTML = keys.map(key => {
    const s = SERVICES[key];
    const selectedTier = state.selectedServices[key];
    const isIncomplete = selectedTier === '';
    const tierKeys = ['small', 'standard', 'large'];

    const sizeBtns = tierKeys.map(tk => {
      const t = s.tiers[tk];
      const isActive = selectedTier === tk;
      const isPopular = tk === 'standard';
      const classes = ['size-btn'];
      if (isActive) classes.push('active');
      if (isPopular) classes.push('size-btn--popular');

      return `
        <button class="${classes.join(' ')}" onclick="setTier('${key}','${tk}')">
          ${isPopular ? '<span class="size-btn__popular">Most Chosen</span>' : ''}
          <span class="size-btn__label">${tk === 'small' ? 'Small' : tk === 'standard' ? 'Standard' : 'Large'}</span>
          <span class="size-btn__price">${fmt(t.low)}\u2013${fmt(t.high)}</span>
          <span class="size-btn__sqft">${t.sqft}</span>
        </button>`;
    }).join('');

    return `
      <div class="config-item${isIncomplete ? ' config-item--incomplete' : ''}">
        <div class="config-item__header">
          <span class="config-item__title">${s.name}${isIncomplete ? ' \u2014 select a size' : ''}</span>
          <button class="config-item__remove" onclick="toggleService('${key}')" title="Remove">&times;</button>
        </div>
        <div class="size-row">${sizeBtns}</div>
      </div>`;
  }).join('');

  // Context hint
  const configuredCount = keys.filter(k => state.selectedServices[k]).length;
  const unconfiguredCount = keys.length - configuredCount;

  if (unconfiguredCount > 0) {
    contextHintText.textContent = 'Choose a project size for each service to see your estimate.';
    contextHint.style.display = '';
  } else if (keys.length >= 2) {
    contextHintText.textContent = keys.length >= 4
      ? 'Whole-property discount applied automatically.'
      : keys.length >= 3
        ? 'Multi-service discount applied automatically.'
        : 'Multi-service discount included in your estimate.';
    contextHint.style.display = '';
  } else {
    contextHint.style.display = 'none';
  }
}

// =====================================================================
// RENDER: Condition Buttons
// =====================================================================
function renderConditions() {
  conditionRowEl.innerHTML = CONDITIONS.map(c => `
    <button class="condition-btn${state.condition === c.id ? ' active' : ''}" onclick="setCondition('${c.id}')">
      <span class="condition-btn__label">${c.label}</span>
      <span class="condition-btn__adj">${c.adj}</span>
    </button>`).join('');
}

// =====================================================================
// RENDER: Add-ons
// =====================================================================
function renderAddons() {
  addonsEl.innerHTML = ADDONS.map(a => `
    <div class="addon${state.activeAddons.has(a.id) ? ' active' : ''}" onclick="toggleAddon('${a.id}')">
      <div class="addon__check">
        <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
      </div>
      <div class="addon__body">
        <div class="addon__name">${a.name}</div>
        <div class="addon__desc">${a.desc}</div>
      </div>
      <div class="addon__price">${fmt(a.price)}</div>
    </div>`).join('');
}

// =====================================================================
// ACTIONS
// =====================================================================
function toggleService(key) {
  if (key in state.selectedServices) {
    delete state.selectedServices[key];
  } else {
    state.selectedServices[key] = '';
  }
  renderServiceGrid();
  renderConfigs();
  calculate();
}

function setTier(serviceKey, tierKey) {
  state.selectedServices[serviceKey] = tierKey;
  renderConfigs();
  calculate();
}

function setCondition(id) {
  state.condition = id;
  renderConditions();
  calculate();
}

function toggleAddon(id) {
  if (state.activeAddons.has(id)) state.activeAddons.delete(id);
  else state.activeAddons.add(id);
  renderAddons();
  calculate();
}

// =====================================================================
// DISCOUNT LOGIC
// =====================================================================
function getDiscount() {
  const count = Object.keys(state.selectedServices).length;
  for (const d of BUNDLE_DISCOUNTS) {
    if (count >= d.min) return d;
  }
  return null;
}

// =====================================================================
// CALCULATE
// =====================================================================
function calculate() {
  const entries = Object.entries(state.selectedServices);
  const configured = entries.filter(([, tier]) => tier !== '');
  const incomplete = entries.filter(([, tier]) => tier === '');

  // Condition multiplier
  const condObj = CONDITIONS.find(c => c.id === state.condition);
  const condMult = 1 + (condObj ? condObj.pct / 100 : 0);

  // Update CTA label based on view
  ctaLabel.textContent = state.viewMode === 'operator' ? 'Copy Detailed Breakdown' : 'Copy Quote Summary';

  // E) Incomplete service notice
  if (incomplete.length > 0) {
    const names = incomplete.map(([key]) => SERVICES[key].name).join(', ');
    incompleteNotice.textContent = 'Select a size for: ' + names;
    incompleteNotice.style.display = '';
  } else {
    incompleteNotice.style.display = 'none';
  }

  if (configured.length === 0) {
    breakdownCustomerEl.innerHTML = '<div class="quote-empty">Select a service to get started.</div>';
    breakdownOperatorEl.innerHTML = '<div class="quote-empty">Select a service to get started.</div>';
    totalTypicalEl.innerHTML = '&mdash;';
    totalTypicalEl.classList.remove('live');
    totalRangeEl.innerHTML = '&mdash;';
    totalRangeEl.classList.remove('live');
    totalContextCustomerEl.textContent = '';
    totalContextOperatorEl.textContent = '';
    disclaimerCustomerEl.textContent = '';
    disclaimerOperatorEl.textContent = '';
    bundleNote.classList.remove('visible');
    ctaEl.disabled = true;
    detailsToggleEl.style.display = 'none';
    return;
  }

  const allConfigured = entries.length > 0 && entries.every(([, tier]) => tier !== '');

  // Sum service ranges
  let servLow = 0, servHigh = 0;
  const serviceRows = [];

  for (const [key, tierKey] of configured) {
    const s = SERVICES[key];
    const t = s.tiers[tierKey];
    const low = Math.round(t.low * condMult);
    const high = Math.round(t.high * condMult);
    servLow += low;
    servHigh += high;
    const sizeLabel = tierKey === 'small' ? 'Small' : tierKey === 'standard' ? 'Standard' : 'Large';
    serviceRows.push({ name: s.name, sizeLabel, label: s.name + ' \u00B7 ' + sizeLabel, low, high });
  }

  // Discount on services
  const disc = getDiscount();
  let discountLow = 0, discountHigh = 0;
  if (disc) {
    discountLow = Math.round(servLow * disc.pct / 100);
    discountHigh = Math.round(servHigh * disc.pct / 100);
  }

  // Addons
  let addonsTotal = 0;
  const addonRows = [];
  ADDONS.forEach(a => {
    if (state.activeAddons.has(a.id)) {
      addonsTotal += a.price;
      addonRows.push({ label: a.name, price: a.price });
    }
  });

  const totalLow  = servLow - discountLow + addonsTotal;
  const totalHigh = servHigh - discountHigh + addonsTotal;
  const totalMid  = Math.round((totalLow + totalHigh) / 2);

  // ===== Build Operator Breakdown (full range) =====
  let opHtml = '';
  serviceRows.forEach(r => {
    opHtml += `<div class="bk-row bk-row--service">
      <span class="bk-label"><span class="bk-dot"></span>${r.label}</span>
      <span class="bk-value">${fmt(r.low)} \u2013 ${fmt(r.high)}</span>
    </div>`;
  });

  if (condObj && condObj.pct > 0) {
    opHtml += `<div class="bk-row">
      <span class="bk-label" style="color:var(--amber)">${condObj.label} (+${condObj.pct}%)</span>
      <span class="bk-value" style="color:var(--amber)">Included above</span>
    </div>`;
  }

  if (disc) {
    opHtml += `<div class="bk-row">
      <span class="bk-label" style="color:var(--green)">Bundle pricing (${disc.pct}% off)</span>
      <span class="bk-value" style="color:var(--green)">\u2212${fmt(discountLow)} \u2013 ${fmt(discountHigh)}</span>
    </div>`;
  }

  addonRows.forEach(r => {
    opHtml += `<div class="bk-row bk-row--addon">
      <span class="bk-label">${r.label}</span>
      <span class="bk-value">${fmt(r.price)}</span>
    </div>`;
  });

  breakdownOperatorEl.innerHTML = opHtml;

  // ===== Build Customer Breakdown (simplified) =====
  let custHtml = '';
  serviceRows.forEach(r => {
    const mid = Math.round((r.low + r.high) / 2);
    custHtml += `<div class="bk-row bk-row--service">
      <span class="bk-label"><span class="bk-dot"></span>${r.name}</span>
      <span class="bk-value">${fmt(mid)}</span>
    </div>`;
  });

  if (disc) {
    const discMid = Math.round((discountLow + discountHigh) / 2);
    custHtml += `<div class="bk-row">
      <span class="bk-label" style="color:var(--green)">Bundle pricing applied</span>
      <span class="bk-value" style="color:var(--green)">\u2212${fmt(discMid)}</span>
    </div>`;
  }

  addonRows.forEach(r => {
    custHtml += `<div class="bk-row bk-row--addon">
      <span class="bk-label">${r.label}</span>
      <span class="bk-value">${fmt(r.price)}</span>
    </div>`;
  });

  breakdownCustomerEl.innerHTML = custHtml;

  // ===== Details breakdown (full range, shown in expandable) =====
  let detHtml = '';
  detHtml += `<div style="font-size:0.68rem;font-weight:600;text-transform:uppercase;letter-spacing:0.08em;color:var(--text-muted);padding:0.25rem 0;">Full Range Breakdown</div>`;
  serviceRows.forEach(r => {
    detHtml += `<div class="bk-row bk-row--service">
      <span class="bk-label"><span class="bk-dot"></span>${r.label}</span>
      <span class="bk-value">${fmt(r.low)} \u2013 ${fmt(r.high)}</span>
    </div>`;
  });
  if (disc) {
    detHtml += `<div class="bk-row">
      <span class="bk-label" style="color:var(--green)">Bundle pricing (${disc.pct}% off)</span>
      <span class="bk-value" style="color:var(--green)">\u2212${fmt(discountLow)} \u2013 ${fmt(discountHigh)}</span>
    </div>`;
  }
  detHtml += `<div class="bk-row" style="font-weight:600;">
    <span class="bk-label" style="color:var(--text-primary)">Total Range</span>
    <span class="bk-value">${fmt(totalLow)} \u2013 ${fmt(totalHigh)}</span>
  </div>`;
  breakdownDetailsEl.innerHTML = detHtml;

  // ===== Totals =====
  totalTypicalEl.textContent = fmt(totalMid);
  totalTypicalEl.classList.add('live');
  totalContextCustomerEl.textContent = 'Based on typical project scope';
  disclaimerCustomerEl.textContent = DISCLAIMER;

  totalRangeEl.textContent = fmt(totalLow) + ' \u2013 ' + fmt(totalHigh);
  totalRangeEl.classList.add('live');
  totalContextOperatorEl.textContent = disc ? 'Typical project: ' + fmt(totalMid) : '';
  disclaimerOperatorEl.textContent = DISCLAIMER;

  // Bundle note
  if (disc) {
    bundleNoteText.textContent = 'Bundle pricing applied';
    bundleNote.classList.add('visible');
  } else {
    bundleNote.classList.remove('visible');
  }

  // Details toggle visibility
  detailsToggleEl.style.display = allConfigured ? '' : 'none';

  // CTA  disabled if any service missing a size
  ctaEl.disabled = !allConfigured;

  // Store for copy
  window._lastQuote = { serviceRows, addonRows, disc, discountLow, discountHigh, totalLow, totalHigh, totalMid, condObj, addonsTotal };
}

// =====================================================================
// B) CTA = COPY
// =====================================================================
function handleCta() {
  const q = window._lastQuote;
  if (!q) return;

  const text = state.viewMode === 'operator' ? buildOperatorText(q) : buildCustomerText(q);
  copyToClipboard(text);
}

function buildCustomerText(q) {
  let lines = ['NC Wash Works \u2014 Quote Summary', ''];
  q.serviceRows.forEach(r => {
    lines.push(`${r.name} \u00B7 ${r.sizeLabel}`);
  });
  lines.push('');
  if (q.condObj && q.condObj.pct > 0) {
    lines.push('Surface condition: ' + q.condObj.label);
  }
  if (q.disc) {
    lines.push('Bundle pricing applied');
  }
  q.addonRows.forEach(r => {
    lines.push('+ ' + r.label + ': ' + fmt(r.price));
  });
  lines.push('');
  lines.push('Typical Estimate: ' + fmt(q.totalMid));
  lines.push('');
  lines.push(DISCLAIMER);
  return lines.join('\n');
}

function buildOperatorText(q) {
  let lines = ['NC Wash Works \u2014 Detailed Breakdown', ''];
  q.serviceRows.forEach(r => {
    lines.push(r.label + ': ' + fmt(r.low) + '\u2013' + fmt(r.high));
  });
  if (q.condObj && q.condObj.pct > 0) {
    lines.push('Surface condition: ' + q.condObj.label + ' (+' + q.condObj.pct + '%)');
  }
  if (q.disc) {
    lines.push('Bundle pricing: \u2212' + fmt(q.discountLow) + '\u2013' + fmt(q.discountHigh) + ' (' + q.disc.pct + '% off)');
  }
  q.addonRows.forEach(r => {
    lines.push('+ ' + r.label + ': ' + fmt(r.price));
  });
  lines.push('');
  lines.push('Estimated Range: ' + fmt(q.totalLow) + ' \u2013 ' + fmt(q.totalHigh));
  lines.push('Typical Project: ' + fmt(q.totalMid));
  lines.push('');
  lines.push(DISCLAIMER);
  return lines.join('\n');
}

function copyToClipboard(text) {
  if (navigator.clipboard && navigator.clipboard.writeText) {
    navigator.clipboard.writeText(text).then(() => {
      showToast('Copied to clipboard');
    }).catch(() => {
      showClipboardFallback(text);
    });
  } else {
    showClipboardFallback(text);
  }
}

function showClipboardFallback(text) {
  clipText.value = text;
  clipModal.classList.add('open');
  setTimeout(() => {
    clipText.focus();
    clipText.select();
  }, 100);
}

function selectAllClipboard() {
  clipText.focus();
  clipText.select();
}

function closeClipboardModal() {
  clipModal.classList.remove('open');
}

clipModal.addEventListener('click', e => { if (e.target === clipModal) closeClipboardModal(); });

// =====================================================================
// MODAL KEYBOARD
// =====================================================================
document.addEventListener('keydown', e => {
  if (e.key === 'Escape') {
    closePinModal();
    closeResetModal();
    closeClipboardModal();
  }
});

// =====================================================================
// INIT
// =====================================================================
updateOperatorBtnUI();
renderServiceGrid();
renderConditions();
renderAddons();
calculate();
</script>

</body>
</html>
